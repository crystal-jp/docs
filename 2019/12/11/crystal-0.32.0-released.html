<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Crystal 0.32.0 released! - The Crystal Programming Language</title>
    <meta charset='utf-8'>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'>
    <link href="/assets/stylesheet.css" rel="stylesheet" />
    <link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Crystal 0.32.0 released! | プログラミング言語 Crystal</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Crystal 0.32.0 released!" />
<meta name="author" content="bcardiff,ftarulla" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Crystal 0.32.0 has been released!" />
<meta property="og:description" content="Crystal 0.32.0 has been released!" />
<link rel="canonical" href="https://ja.crystal-lang.org/2019/12/11/crystal-0.32.0-released.html" />
<meta property="og:url" content="https://ja.crystal-lang.org/2019/12/11/crystal-0.32.0-released.html" />
<meta property="og:site_name" content="プログラミング言語 Crystal" />
<meta property="og:image" content="https://ja.crystal-lang.org/assets/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-12-11T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ja.crystal-lang.org/assets/icon.png" />
<meta property="twitter:title" content="Crystal 0.32.0 released!" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@bcardiff,ftarulla" />
<script type="application/ld+json">
{"datePublished":"2019-12-11T00:00:00+00:00","dateModified":"2019-12-11T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ja.crystal-lang.org/2019/12/11/crystal-0.32.0-released.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ja.crystal-lang.org/assets/media/crystal_logo.svg"},"name":"bcardiff,ftarulla"},"url":"https://ja.crystal-lang.org/2019/12/11/crystal-0.32.0-released.html","author":{"@type":"Person","name":"bcardiff,ftarulla"},"@type":"BlogPosting","image":"https://ja.crystal-lang.org/assets/icon.png","headline":"Crystal 0.32.0 released!","description":"Crystal 0.32.0 has been released!","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Let browser know website is optimized for mobile -->
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper ">
  <nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/conference/">
      Conference
    </a>
  </li>
<li>
    <a href="/team/">
      Team
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/conference/">
      Conference
    </a>
  </li>
<li>
    <a href="/team/">
      Team
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>


  <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/bcardiff.jpg" />
          
            <img src="/assets/authors/ftarulla.jpg" />
          
          
            <span class="author_name">Brian J. Cardiff</span>
          
            <span class="author_name">Francisco Tarulla</span>
          
          <span class="date">11 Dec 2019</span>
        </div>

        <h1 class='title'>Crystal 0.32.0 released!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>


<main>
  <div class="container">
    <div class="row post-layout">
      <div class="col m2 share">
        <p class="title small share-title">Share</p>
        <div class="share-list">
          
          <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fja.crystal-lang.org%2F2019%2F12%2F11%2Fcrystal-0.32.0-released.html&text=Crystal+0.32.0+released%21&via=CrystalLanguage" target="_blank">
            <div class="share-item"><i class="extra-icons twitter gray"></i></div>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fja.crystal-lang.org%2F2019%2F12%2F11%2Fcrystal-0.32.0-released.html" target="_blank">
            <div class="share-item"><i class="extra-icons facebook gray"></i></div>
          </a>
          <a href="https://plus.google.com/share?url=https%3A%2F%2Fja.crystal-lang.org%2F2019%2F12%2F11%2Fcrystal-0.32.0-released.html" target="_blank">
            <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
            </a>
        </div>
      </div>

      <div class="col s12 m9">
        <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.32.0">Crystal 0.32.0</a> has been released!</p>

<p>This release comes with consistencies, happiness, improvements in std-lib and tools, and important changes in concurrency.</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.31.1...0.32.0">197 commits since 0.31.1</a> by 44 contributors.</p>

<p>Let’s review some highlights in this release. But don’t miss out on the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.32.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="language-changes">Language changes</h2>

<p>The language took one more tiny step in the direction of consistency. The boolean negation method <code class="language-crystal highlighter-rouge"><span class="o">!</span></code> can now be called as a regular method call as <code class="language-crystal highlighter-rouge"><span class="n">expr</span><span class="o">.!</span></code>. This kind of changes are great to avoid quirks in metaprogramming. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8445">#8445</a>.</p>

<h3 id="macros">Macros</h3>

<p>Other consistencies in the macro realm are the possibility to list class variables using <code class="language-crystal highlighter-rouge"><span class="no">TypeNode</span><span class="c1">#class_vars</span></code>, and been able to use <code class="language-crystal highlighter-rouge"><span class="n">map_with_index</span></code> on <code class="language-crystal highlighter-rouge"><span class="no">ArrayLiteral</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">TupleLiteral</span></code>. Macro lovers can find more about these changes at <a href="https://github.com/crystal-lang/crystal/pull/8405">#8405</a>, <a href="https://github.com/crystal-lang/crystal/pull/8049">#8049</a>, and <a href="https://github.com/crystal-lang/crystal/pull/8379">#8379</a>.</p>

<p>A powerful feature is that you are now able to list all types a module is directly included in by using <code class="language-crystal highlighter-rouge"><span class="no">TypeNode</span><span class="c1">#includers</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8133">#8133</a>.</p>

<h2 id="compiler">Compiler</h2>

<h3 id="language-semantics">Language semantics</h3>

<p>There was a method lookup bug fixed at <a href="https://github.com/crystal-lang/crystal/pull/8258">#8258</a>. You need to worry only if you have multiple overloads of the same method with a very specific combination of aliases and union types (one of them uses an alias to a union involving a type that also has an overload).</p>

<p>Given</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="k">alias</span> <span class="no">X</span> <span class="o">=</span> <span class="no">Int8</span> <span class="o">|</span> <span class="no">Int32</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">)</span>
  <span class="mi">42</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">X</span><span class="p">)</span>
  <span class="s1">'a'</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Since Crystal 0.32.0 <code class="language-crystal highlighter-rouge"><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code> returns <code class="language-crystal highlighter-rouge"><span class="mi">42</span></code>, instead of <code class="language-crystal highlighter-rouge"><span class="n">a</span></code>.</p>

<h3 id="doc-generator">Doc generator</h3>

<p>The doc generator can produce a <code class="language-crystal highlighter-rouge"><span class="n">sitemap</span><span class="p">.</span><span class="nf">xml</span></code> which lists all HTML pages accessible for search engines. The goal is to use this sitemap to assign lower priorities to outdated doc pages. This mechanism is even better than setting a canonical url for indexed documentation. The compiler will make use of this in the near future and it might be useful for hosted documentations out there. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8348">#8348</a> and <a href="https://github.com/crystal-lang/crystal-website/issues/79">crystal-website#79</a>.</p>

<p>As the language evolves, some conventions and features can be better advertised. For yielding methods, a non-capture block argument <code class="language-crystal highlighter-rouge"><span class="o">&amp;</span></code> will be shown in the documentation signature.
Read more at <a href="https://github.com/crystal-lang/crystal/pull/8394">#8394</a>, and if you want to recall what the non-capture block argument is, check again <a href="https://github.com/crystal-lang/crystal/pull/8117">#8117</a> from 0.31.0.</p>

<h2 id="distributions">Distributions</h2>

<p>As a heads up, the base docker image since 0.32.0 is updated to bionic and llvm-8.0. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8442">#8442</a>.</p>

<h2 id="standard-library">Standard library</h2>

<p>Attention to details contributes to happiness. There will no longer be <code class="language-crystal highlighter-rouge"><span class="no">Nil</span> <span class="n">assertion</span> <span class="n">failed</span></code> without context for <code class="language-crystal highlighter-rouge"><span class="kp">getter</span><span class="o">!</span></code> and <code class="language-crystal highlighter-rouge"><span class="kp">property</span><span class="o">!</span></code>. The type and method information will be included for clarity.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="k">class</span> <span class="nc">Foo</span>
  <span class="kp">getter</span><span class="o">!</span> <span class="n">bar</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="vi">@bar</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">?</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">bar</span> <span class="c1"># raises NilAssertionError: Foo#bar can't be nil</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8200">#8200</a> and  <a href="https://github.com/crystal-lang/crystal/pull/8296">#8296</a>.</p>

<h3 id="spec">Spec</h3>

<p>Be prepared for spec happiness. You can now specify code to run before, after and around the <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> blocks of a spec or the hole suite. You can also scope these hooks to run on a specific <code class="language-crystal highlighter-rouge"><span class="n">context</span></code> or <code class="language-crystal highlighter-rouge"><span class="n">describe</span></code> block. Note that variables declared inside hooks are not accessible in the <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> block itself, so they are aimed to play with shared context or setup resources.</p>

<p>The methods you will be looking for are <code class="language-crystal highlighter-rouge"><span class="n">before_each</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">after_each</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">before_all</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">after_all</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">around_each</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">around_all</span></code> and can be used as follows:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">require</span> <span class="s2">"spec"</span>

<span class="n">describe</span> <span class="s2">"Users"</span> <span class="k">do</span>
  <span class="n">before_all</span> <span class="k">do</span>
    <span class="c1"># setup a database</span>
  <span class="k">end</span>

  <span class="n">before_each</span> <span class="k">do</span>
    <span class="c1"># truncate all tables</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"can create entity"</span> <span class="k">do</span>
    <span class="c1"># test something assuming empty db</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"initialized system"</span> <span class="k">do</span>
    <span class="n">before_each</span> <span class="k">do</span>
      <span class="c1"># initialize some data</span>
    <span class="k">end</span>

    <span class="n">after_each</span> <span class="k">do</span>
      <span class="c1"># clean up some resources</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">"existing entity can work"</span> <span class="k">do</span>
      <span class="c1"># test something assuming initialized data</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Read more about spec hooks at <a href="https://github.com/crystal-lang/crystal/pull/8302">#8302</a>.</p>

<p>The happiness does not stop there. You are able to tag <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> block in specs with single or multiple strings that will allow you to select which ones to run using <code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">spec</span></code> CLI.</p>

<p>In a <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> block add a named argument <code class="language-crystal highlighter-rouge"><span class="n">tags</span></code> which may contain either a <code class="language-crystal highlighter-rouge"><span class="no">String</span></code> or an <code class="language-crystal highlighter-rouge"><span class="no">Array</span><span class="p">(</span><span class="no">String</span><span class="p">)</span></code>.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">describe</span> <span class="no">Foo</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"(1) an untagged test"</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(2) a fast test"</span><span class="p">,</span> <span class="ss">tags: </span><span class="s2">"fast"</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(3) a slow test"</span><span class="p">,</span> <span class="ss">tags: </span><span class="s2">"slow"</span><span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(4) a test with a star"</span><span class="p">,</span> <span class="ss">tags: </span><span class="s2">"starred"</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(5) a slow test with a star"</span><span class="p">,</span> <span class="ss">tags: </span><span class="sx">%w(slow starred)</span> <span class="k">do</span>  <span class="c1"># same as tags: ["slow", "starred"]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Filter the specs by inclusion or exclusion.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nv">$ </span>crystal spec <span class="nt">--tag</span> fast <span class="c"># runs (2)</span>
<span class="nv">$ </span>crystal spec <span class="nt">--tag</span> ~slow <span class="c"># runs (1) (2) (4)</span>
</code></pre></div></div>

<p>Or even combine them</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nv">$ </span>crystal spec <span class="nt">--tag</span> starred <span class="nt">--tag</span> fast <span class="c"># runs (2) (4) (5)</span>
<span class="nv">$ </span>crystal spec <span class="nt">--tag</span> starred <span class="nt">--tag</span> ~slow <span class="c"># runs (4)</span>
</code></pre></div></div>

<p>Please do not use tags prefixed with <code class="language-crystal highlighter-rouge"><span class="o">~</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8068">#8068</a>.</p>

<p>And, last but not least, when using <code class="language-crystal highlighter-rouge"><span class="n">should</span></code> or <code class="language-crystal highlighter-rouge"><span class="n">should_not</span></code> with <code class="language-crystal highlighter-rouge"><span class="n">be_a</span><span class="p">(</span><span class="no">T</span><span class="p">)</span></code> or <code class="language-crystal highlighter-rouge"><span class="n">be_nil</span></code> you are now able to use the result of the expression as a narrowed type and call methods that would otherwise complain due to the original union.</p>

<p>So, for nillable types you can do the following to avoid <code class="language-crystal highlighter-rouge"><span class="n">not_nil!</span></code> along the way:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">x</span> <span class="o">=</span> <span class="s2">"42"</span><span class="p">.</span><span class="nf">to_i32?</span>        <span class="c1"># x : Int32 | Nil</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">should_not</span> <span class="n">be_nil</span> <span class="c1"># update x to a narrowed type</span>
<span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>               <span class="c1"># Int32</span>
</code></pre></div></div>

<p>And with any arbitrary unions, something like the following to avoid casts:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">||</span> <span class="s1">'a'</span>
<span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                <span class="c1"># =&gt; Int32 | Char</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">should</span> <span class="n">be_a</span><span class="p">(</span><span class="no">Int32</span><span class="p">)</span> <span class="c1"># update x to a narrowed type</span>
<span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                <span class="c1"># =&gt; Int32</span>
<span class="n">x</span><span class="p">.</span><span class="nf">to_f</span>                   <span class="c1"># =&gt; 1.0</span>
</code></pre></div></div>

<h3 id="concurrency-and-parallelism">Concurrency and Parallelism</h3>

<p>There has been important work regarding concurrency and parallelism. <code class="language-crystal highlighter-rouge"><span class="no">Channel</span></code> and how <code class="language-crystal highlighter-rouge"><span class="nb">select</span></code> is implemented got internal refactors and fixes. These changes fix the behavior on closed or closing channels which are more likely to happen with multi-thread. And there have been performance improvements along the way.</p>

<p>Read more about <code class="language-crystal highlighter-rouge"><span class="no">Channel</span></code> internals refactor and optimizations at <a href="https://github.com/crystal-lang/crystal/pull/8322">#8322</a> and <a href="https://github.com/crystal-lang/crystal/pull/8497">#8497</a>.</p>

<p>Read more about the fixes related closed <code class="language-crystal highlighter-rouge"><span class="no">Channel</span></code>  at <a href="https://github.com/crystal-lang/crystal/pull/8284">#8284</a>, <a href="https://github.com/crystal-lang/crystal/pull/8249">#8249</a>, <a href="https://github.com/crystal-lang/crystal/pull/8304">#8304</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="no">Mutex</span></code> also got some improvements, both feature- and performance-wise. Read more about them in <a href="https://github.com/crystal-lang/crystal/pull/8295">#8295</a> and <a href="https://github.com/crystal-lang/crystal/pull/8563">#8563</a>. The <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span></code> as you may know prevents multiple fibers running their critical sections concurrently. This is independent of whether the fibers run in the same or in different threads. There are three behaviors or protection levels the mutex supports. When creating a <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span></code> you might specify which protection level to use: <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:checked</span><span class="p">)</span></code> (default), <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:reentrant</span><span class="p">)</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:unchecked</span><span class="p">)</span></code>.</p>

<p>A <code class="language-crystal highlighter-rouge"><span class="ss">:checked</span></code> mutex provides deadlock protection. Attempting to re-lock the mutex from the same fiber will raise an exception.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="ss">:reentrant</span></code> protection maintains a lock count allowing it to be used in recursive scenarios. Attempting to unlock an unlocked mutex, or a mutex locked by another fiber will raise an exception.</p>

<p>You can disable all protections with <code class="language-crystal highlighter-rouge"><span class="ss">:unchecked</span></code>. This is particularly useful for some scenarios where the lock and unlock of a critical section need to occur in different fibers.</p>

<h3 id="text">Text</h3>

<p>String interpolations are widely used in the language. The std-lib is updated with a <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="p">.</span><span class="nf">interpolation</span></code> method that will be used directly by the compiler. Up to 0.31.1 <code class="language-crystal highlighter-rouge"><span class="s2">"hello </span><span class="si">#{</span><span class="n">world</span><span class="si">}</span><span class="s2">!"</span></code> was a syntax-sugar of</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">String</span><span class="p">.</span><span class="nf">build</span> <span class="k">do</span> <span class="o">|</span><span class="n">io</span><span class="o">|</span>
  <span class="n">io</span> <span class="o">&lt;&lt;</span> <span class="s2">"hello "</span>
  <span class="n">io</span> <span class="o">&lt;&lt;</span> <span class="n">world</span>
  <span class="n">io</span> <span class="o">&lt;&lt;</span> <span class="s2">"!"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>But is now changed to</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">String</span><span class="p">.</span><span class="nf">interpolation</span><span class="p">(</span><span class="s2">"hello "</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">)</span>
</code></pre></div></div>

<p>This subtle change allows performant specialized interpolation logic allowing to forget about <code class="language-crystal highlighter-rouge"><span class="s2">"foo</span><span class="si">#{</span><span class="n">bar</span><span class="si">}</span><span class="s2">"</span></code> vs <code class="language-crystal highlighter-rouge"><span class="s2">"foo"</span> <span class="o">+</span> <span class="n">bar</span></code>.</p>

<p>There is a small breaking change though <code class="language-crystal highlighter-rouge"><span class="s2">"</span><span class="si">#{</span><span class="n">str</span><span class="si">}</span><span class="s2">"</span></code> returns the same string instance stored in <code class="language-crystal highlighter-rouge"><span class="n">str</span></code>. But since <code class="language-crystal highlighter-rouge"><span class="no">String</span></code> is immutable you should not worry about that change. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8400">#8400</a>.</p>

<p>For input parsing we have these cool new methods: <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="c1">#presence</span></code> (and <code class="language-crystal highlighter-rouge"><span class="no">Nil</span><span class="c1">#presence</span></code>). Here is an example of what they will let us do:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">puts</span> <span class="s2">"a"</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span> <span class="s2">"default"</span> <span class="c1"># =&gt; "a"</span>
<span class="nb">puts</span> <span class="kp">nil</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span> <span class="s2">"default"</span> <span class="c1"># =&gt; "default"</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8345">#8345</a>, <a href="https://github.com/crystal-lang/crystal/pull/8508">#8508</a></p>

<p>We will stop supporting <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="c1">#codepoint_at</span></code> in favor of <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="c1">#char_at(index).ord</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8475">#8475</a>.</p>

<h3 id="collections">Collections</h3>

<p>We won’t be using <code class="language-crystal highlighter-rouge"><span class="no">Enumerable</span><span class="c1">#grep</span></code> anymore.  Now we are just using <code class="language-crystal highlighter-rouge"><span class="no">Enumerable</span><span class="c1">#select</span></code>.</p>

<p>So, instead of:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">puts</span> <span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span> <span class="s2">"Bar"</span><span class="p">,</span> <span class="s2">"Baz"</span><span class="p">].</span><span class="nf">grep</span><span class="p">(</span><span class="sr">/^B/</span><span class="p">)</span> <span class="c1"># =&gt; ["Bar", "Baz"]</span>
</code></pre></div></div>

<p>We are going to use:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">puts</span> <span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span> <span class="s2">"Bar"</span><span class="p">,</span> <span class="s2">"Baz"</span><span class="p">].</span><span class="nf">select</span><span class="p">(</span><span class="sr">/^B/</span><span class="p">)</span> <span class="c1"># =&gt; ["Bar", "Baz"]</span>
<span class="c1"># or</span>
<span class="nb">puts</span> <span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span> <span class="s2">"Bar"</span><span class="p">,</span> <span class="s2">"Baz"</span><span class="p">].</span><span class="nf">select</span> <span class="p">{</span><span class="o">|</span><span class="n">word</span><span class="o">|</span> <span class="n">word</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"B"</span><span class="p">)}</span> <span class="c1"># =&gt; ["Bar", "Baz"]</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8452">#8452</a>.</p>

<p>With this version we may tell a <code class="language-crystal highlighter-rouge"><span class="no">Hash</span></code> (or a <code class="language-crystal highlighter-rouge"><span class="no">Set</span></code>) to compare <code class="language-crystal highlighter-rouge"><span class="n">keys</span></code> by <code class="language-crystal highlighter-rouge"><span class="nb">object_id</span></code>. After calling <code class="language-crystal highlighter-rouge"><span class="n">compare_by_identity</span></code> how the receiver hash behaves will change. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8451">#8451</a>.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">h1</span><span class="p">[</span><span class="s2">"fo"</span> <span class="o">+</span> <span class="s2">"o"</span><span class="p">]?</span> <span class="c1"># =&gt; 1</span>

<span class="n">h1</span><span class="p">.</span><span class="nf">compare_by_identity</span>
<span class="n">h1</span><span class="p">.</span><span class="nf">compare_by_identity?</span> <span class="c1"># =&gt; true</span>
<span class="n">h1</span><span class="p">[</span><span class="s2">"fo"</span> <span class="o">+</span> <span class="s2">"o"</span><span class="p">]?</span>         <span class="c1"># =&gt; nil # not the same String instance</span>
</code></pre></div></div>

<p>Iterating over an array with chunks of 2 elements? Well, we have a treat for you. Now we may use <code class="language-crystal highlighter-rouge"><span class="no">Enumerable</span><span class="c1">#each_cons_pair</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">Iterator</span><span class="c1">#cons_pair</span></code> with rocket-enhanced performance! Read more at <a href="https://github.com/crystal-lang/crystal/pull/8332">#8332</a>.</p>

<h3 id="serialization">Serialization</h3>

<p>While using <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="p">.</span><span class="nf">mapping</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="p">.</span><span class="nf">mapping</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">Serializable</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Serializable</span></code> sometimes the data is not quite in the right format or doesn’t quite match the type we expect. The <code class="language-crystal highlighter-rouge"><span class="n">converter</span></code> option allows you to inject some logic while converting from/to the different format. There are some new awesome helper modules: <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">ArrayConverter</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">ArrayConverter</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">HashValueConverter</span></code> that will allow to define the converters on the items or values to be used. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8156">#8156</a>.</p>

<p>If the above does not make you happy enough, wait until you discover <code class="language-crystal highlighter-rouge"><span class="n">use_json_discriminator</span></code> and <code class="language-crystal highlighter-rouge"><span class="n">use_yaml_discriminator</span></code>, that will allow you to specify which concrete type to use, based on a property value. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8406">#8406</a>.</p>

<p>Breaking news! <code class="language-crystal highlighter-rouge"><span class="no">XML</span><span class="o">::</span><span class="no">Reader</span><span class="c1">#expand</span></code> will raise an error, and if we want the old behavior then we have <code class="language-crystal highlighter-rouge"><span class="no">XML</span><span class="o">::</span><span class="no">Reader</span><span class="c1">#expand?</span></code> Making things more consistent! Read more at <a href="https://github.com/crystal-lang/crystal/pull/8186">#8186</a>.</p>

<h3 id="files">Files</h3>

<p>Breaking news! <code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">Path</span><span class="c1">#expand</span></code> will no longer expand home (<code class="language-crystal highlighter-rouge"><span class="o">~</span></code>) by default. It is now an opt-in argument: <code class="language-crystal highlighter-rouge"><span class="ss">home: </span><span class="kp">true</span></code> or even `home: “/use/this/as/home”. Read more at <a href="https://github.com/crystal-lang/crystal/pull/7903">#7903</a>.</p>

<h2 id="db">DB</h2>

<p><code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="o">-</span><span class="n">lang</span><span class="o">/</span><span class="n">crystal</span><span class="o">-</span><span class="n">db</span></code> got a new release: 0.8.0. The shiny new feature is the <code class="language-crystal highlighter-rouge"><span class="no">DB</span><span class="o">::</span><span class="no">Serializable</span></code> module and <code class="language-crystal highlighter-rouge"><span class="no">DB</span><span class="o">::</span><span class="no">Field</span></code> annotation matching the JSON and YAML counterparts. Read more at  <a href="https://github.com/crystal-lang/crystal-db/pull/115">crystal-db#115</a>.</p>

<p>If you want to use that feature be sure to upgrade to a driver that require 0.8.0 at least.</p>

<h2 id="next-steps">Next steps</h2>

<p>Please update your Crystal and report any issues. We will keep moving forward and start the development focusing on 0.33.</p>

<p>It will also be helpful if your shards are run against Crystal nightly releases. Either Docker or Snap are the current channels to get them easily. This will help reduce the friction of a release while checking if the ecosystem is in good shape.</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, and every other <a href="/sponsors">sponsor</a>. It is extremely important for us to sustain the support through donations, so that we can maintain this development pace. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!</p>


      </div>
      <div class="col m1"></div>
    </div>

    <div class="row disqus">
      <div class="col m2"></div>
      <div class="col s12 m9" id='disqus_thread'>
        <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.32.0">Crystal 0.32.0</a> has been released!</p>

<p>This release comes with consistencies, happiness, improvements in std-lib and tools, and important changes in concurrency.</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.31.1...0.32.0">197 commits since 0.31.1</a> by 44 contributors.</p>

<p>Let’s review some highlights in this release. But don’t miss out on the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.32.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="language-changes">Language changes</h2>

<p>The language took one more tiny step in the direction of consistency. The boolean negation method <code class="language-crystal highlighter-rouge"><span class="o">!</span></code> can now be called as a regular method call as <code class="language-crystal highlighter-rouge"><span class="n">expr</span><span class="o">.!</span></code>. This kind of changes are great to avoid quirks in metaprogramming. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8445">#8445</a>.</p>

<h3 id="macros">Macros</h3>

<p>Other consistencies in the macro realm are the possibility to list class variables using <code class="language-crystal highlighter-rouge"><span class="no">TypeNode</span><span class="c1">#class_vars</span></code>, and been able to use <code class="language-crystal highlighter-rouge"><span class="n">map_with_index</span></code> on <code class="language-crystal highlighter-rouge"><span class="no">ArrayLiteral</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">TupleLiteral</span></code>. Macro lovers can find more about these changes at <a href="https://github.com/crystal-lang/crystal/pull/8405">#8405</a>, <a href="https://github.com/crystal-lang/crystal/pull/8049">#8049</a>, and <a href="https://github.com/crystal-lang/crystal/pull/8379">#8379</a>.</p>

<p>A powerful feature is that you are now able to list all types a module is directly included in by using <code class="language-crystal highlighter-rouge"><span class="no">TypeNode</span><span class="c1">#includers</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8133">#8133</a>.</p>

<h2 id="compiler">Compiler</h2>

<h3 id="language-semantics">Language semantics</h3>

<p>There was a method lookup bug fixed at <a href="https://github.com/crystal-lang/crystal/pull/8258">#8258</a>. You need to worry only if you have multiple overloads of the same method with a very specific combination of aliases and union types (one of them uses an alias to a union involving a type that also has an overload).</p>

<p>Given</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="k">alias</span> <span class="no">X</span> <span class="o">=</span> <span class="no">Int8</span> <span class="o">|</span> <span class="no">Int32</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">)</span>
  <span class="mi">42</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">X</span><span class="p">)</span>
  <span class="s1">'a'</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Since Crystal 0.32.0 <code class="language-crystal highlighter-rouge"><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code> returns <code class="language-crystal highlighter-rouge"><span class="mi">42</span></code>, instead of <code class="language-crystal highlighter-rouge"><span class="n">a</span></code>.</p>

<h3 id="doc-generator">Doc generator</h3>

<p>The doc generator can produce a <code class="language-crystal highlighter-rouge"><span class="n">sitemap</span><span class="p">.</span><span class="nf">xml</span></code> which lists all HTML pages accessible for search engines. The goal is to use this sitemap to assign lower priorities to outdated doc pages. This mechanism is even better than setting a canonical url for indexed documentation. The compiler will make use of this in the near future and it might be useful for hosted documentations out there. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8348">#8348</a> and <a href="https://github.com/crystal-lang/crystal-website/issues/79">crystal-website#79</a>.</p>

<p>As the language evolves, some conventions and features can be better advertised. For yielding methods, a non-capture block argument <code class="language-crystal highlighter-rouge"><span class="o">&amp;</span></code> will be shown in the documentation signature.
Read more at <a href="https://github.com/crystal-lang/crystal/pull/8394">#8394</a>, and if you want to recall what the non-capture block argument is, check again <a href="https://github.com/crystal-lang/crystal/pull/8117">#8117</a> from 0.31.0.</p>

<h2 id="distributions">Distributions</h2>

<p>As a heads up, the base docker image since 0.32.0 is updated to bionic and llvm-8.0. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8442">#8442</a>.</p>

<h2 id="standard-library">Standard library</h2>

<p>Attention to details contributes to happiness. There will no longer be <code class="language-crystal highlighter-rouge"><span class="no">Nil</span> <span class="n">assertion</span> <span class="n">failed</span></code> without context for <code class="language-crystal highlighter-rouge"><span class="kp">getter</span><span class="o">!</span></code> and <code class="language-crystal highlighter-rouge"><span class="kp">property</span><span class="o">!</span></code>. The type and method information will be included for clarity.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="k">class</span> <span class="nc">Foo</span>
  <span class="kp">getter</span><span class="o">!</span> <span class="n">bar</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="vi">@bar</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">?</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">bar</span> <span class="c1"># raises NilAssertionError: Foo#bar can't be nil</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8200">#8200</a> and  <a href="https://github.com/crystal-lang/crystal/pull/8296">#8296</a>.</p>

<h3 id="spec">Spec</h3>

<p>Be prepared for spec happiness. You can now specify code to run before, after and around the <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> blocks of a spec or the hole suite. You can also scope these hooks to run on a specific <code class="language-crystal highlighter-rouge"><span class="n">context</span></code> or <code class="language-crystal highlighter-rouge"><span class="n">describe</span></code> block. Note that variables declared inside hooks are not accessible in the <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> block itself, so they are aimed to play with shared context or setup resources.</p>

<p>The methods you will be looking for are <code class="language-crystal highlighter-rouge"><span class="n">before_each</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">after_each</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">before_all</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">after_all</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">around_each</span></code>, <code class="language-crystal highlighter-rouge"><span class="n">around_all</span></code> and can be used as follows:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">require</span> <span class="s2">"spec"</span>

<span class="n">describe</span> <span class="s2">"Users"</span> <span class="k">do</span>
  <span class="n">before_all</span> <span class="k">do</span>
    <span class="c1"># setup a database</span>
  <span class="k">end</span>

  <span class="n">before_each</span> <span class="k">do</span>
    <span class="c1"># truncate all tables</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"can create entity"</span> <span class="k">do</span>
    <span class="c1"># test something assuming empty db</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"initialized system"</span> <span class="k">do</span>
    <span class="n">before_each</span> <span class="k">do</span>
      <span class="c1"># initialize some data</span>
    <span class="k">end</span>

    <span class="n">after_each</span> <span class="k">do</span>
      <span class="c1"># clean up some resources</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">"existing entity can work"</span> <span class="k">do</span>
      <span class="c1"># test something assuming initialized data</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Read more about spec hooks at <a href="https://github.com/crystal-lang/crystal/pull/8302">#8302</a>.</p>

<p>The happiness does not stop there. You are able to tag <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> block in specs with single or multiple strings that will allow you to select which ones to run using <code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">spec</span></code> CLI.</p>

<p>In a <code class="language-crystal highlighter-rouge"><span class="n">it</span></code> block add a named argument <code class="language-crystal highlighter-rouge"><span class="n">tags</span></code> which may contain either a <code class="language-crystal highlighter-rouge"><span class="no">String</span></code> or an <code class="language-crystal highlighter-rouge"><span class="no">Array</span><span class="p">(</span><span class="no">String</span><span class="p">)</span></code>.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">describe</span> <span class="no">Foo</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"(1) an untagged test"</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(2) a fast test"</span><span class="p">,</span> <span class="ss">tags: </span><span class="s2">"fast"</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(3) a slow test"</span><span class="p">,</span> <span class="ss">tags: </span><span class="s2">"slow"</span><span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(4) a test with a star"</span><span class="p">,</span> <span class="ss">tags: </span><span class="s2">"starred"</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"(5) a slow test with a star"</span><span class="p">,</span> <span class="ss">tags: </span><span class="sx">%w(slow starred)</span> <span class="k">do</span>  <span class="c1"># same as tags: ["slow", "starred"]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Filter the specs by inclusion or exclusion.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nv">$ </span>crystal spec <span class="nt">--tag</span> fast <span class="c"># runs (2)</span>
<span class="nv">$ </span>crystal spec <span class="nt">--tag</span> ~slow <span class="c"># runs (1) (2) (4)</span>
</code></pre></div></div>

<p>Or even combine them</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nv">$ </span>crystal spec <span class="nt">--tag</span> starred <span class="nt">--tag</span> fast <span class="c"># runs (2) (4) (5)</span>
<span class="nv">$ </span>crystal spec <span class="nt">--tag</span> starred <span class="nt">--tag</span> ~slow <span class="c"># runs (4)</span>
</code></pre></div></div>

<p>Please do not use tags prefixed with <code class="language-crystal highlighter-rouge"><span class="o">~</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8068">#8068</a>.</p>

<p>And, last but not least, when using <code class="language-crystal highlighter-rouge"><span class="n">should</span></code> or <code class="language-crystal highlighter-rouge"><span class="n">should_not</span></code> with <code class="language-crystal highlighter-rouge"><span class="n">be_a</span><span class="p">(</span><span class="no">T</span><span class="p">)</span></code> or <code class="language-crystal highlighter-rouge"><span class="n">be_nil</span></code> you are now able to use the result of the expression as a narrowed type and call methods that would otherwise complain due to the original union.</p>

<p>So, for nillable types you can do the following to avoid <code class="language-crystal highlighter-rouge"><span class="n">not_nil!</span></code> along the way:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">x</span> <span class="o">=</span> <span class="s2">"42"</span><span class="p">.</span><span class="nf">to_i32?</span>        <span class="c1"># x : Int32 | Nil</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">should_not</span> <span class="n">be_nil</span> <span class="c1"># update x to a narrowed type</span>
<span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>               <span class="c1"># Int32</span>
</code></pre></div></div>

<p>And with any arbitrary unions, something like the following to avoid casts:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">||</span> <span class="s1">'a'</span>
<span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                <span class="c1"># =&gt; Int32 | Char</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">should</span> <span class="n">be_a</span><span class="p">(</span><span class="no">Int32</span><span class="p">)</span> <span class="c1"># update x to a narrowed type</span>
<span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                <span class="c1"># =&gt; Int32</span>
<span class="n">x</span><span class="p">.</span><span class="nf">to_f</span>                   <span class="c1"># =&gt; 1.0</span>
</code></pre></div></div>

<h3 id="concurrency-and-parallelism">Concurrency and Parallelism</h3>

<p>There has been important work regarding concurrency and parallelism. <code class="language-crystal highlighter-rouge"><span class="no">Channel</span></code> and how <code class="language-crystal highlighter-rouge"><span class="nb">select</span></code> is implemented got internal refactors and fixes. These changes fix the behavior on closed or closing channels which are more likely to happen with multi-thread. And there have been performance improvements along the way.</p>

<p>Read more about <code class="language-crystal highlighter-rouge"><span class="no">Channel</span></code> internals refactor and optimizations at <a href="https://github.com/crystal-lang/crystal/pull/8322">#8322</a> and <a href="https://github.com/crystal-lang/crystal/pull/8497">#8497</a>.</p>

<p>Read more about the fixes related closed <code class="language-crystal highlighter-rouge"><span class="no">Channel</span></code>  at <a href="https://github.com/crystal-lang/crystal/pull/8284">#8284</a>, <a href="https://github.com/crystal-lang/crystal/pull/8249">#8249</a>, <a href="https://github.com/crystal-lang/crystal/pull/8304">#8304</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="no">Mutex</span></code> also got some improvements, both feature- and performance-wise. Read more about them in <a href="https://github.com/crystal-lang/crystal/pull/8295">#8295</a> and <a href="https://github.com/crystal-lang/crystal/pull/8563">#8563</a>. The <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span></code> as you may know prevents multiple fibers running their critical sections concurrently. This is independent of whether the fibers run in the same or in different threads. There are three behaviors or protection levels the mutex supports. When creating a <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span></code> you might specify which protection level to use: <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:checked</span><span class="p">)</span></code> (default), <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:reentrant</span><span class="p">)</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">Mutex</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:unchecked</span><span class="p">)</span></code>.</p>

<p>A <code class="language-crystal highlighter-rouge"><span class="ss">:checked</span></code> mutex provides deadlock protection. Attempting to re-lock the mutex from the same fiber will raise an exception.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="ss">:reentrant</span></code> protection maintains a lock count allowing it to be used in recursive scenarios. Attempting to unlock an unlocked mutex, or a mutex locked by another fiber will raise an exception.</p>

<p>You can disable all protections with <code class="language-crystal highlighter-rouge"><span class="ss">:unchecked</span></code>. This is particularly useful for some scenarios where the lock and unlock of a critical section need to occur in different fibers.</p>

<h3 id="text">Text</h3>

<p>String interpolations are widely used in the language. The std-lib is updated with a <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="p">.</span><span class="nf">interpolation</span></code> method that will be used directly by the compiler. Up to 0.31.1 <code class="language-crystal highlighter-rouge"><span class="s2">"hello </span><span class="si">#{</span><span class="n">world</span><span class="si">}</span><span class="s2">!"</span></code> was a syntax-sugar of</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">String</span><span class="p">.</span><span class="nf">build</span> <span class="k">do</span> <span class="o">|</span><span class="n">io</span><span class="o">|</span>
  <span class="n">io</span> <span class="o">&lt;&lt;</span> <span class="s2">"hello "</span>
  <span class="n">io</span> <span class="o">&lt;&lt;</span> <span class="n">world</span>
  <span class="n">io</span> <span class="o">&lt;&lt;</span> <span class="s2">"!"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>But is now changed to</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">String</span><span class="p">.</span><span class="nf">interpolation</span><span class="p">(</span><span class="s2">"hello "</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">)</span>
</code></pre></div></div>

<p>This subtle change allows performant specialized interpolation logic allowing to forget about <code class="language-crystal highlighter-rouge"><span class="s2">"foo</span><span class="si">#{</span><span class="n">bar</span><span class="si">}</span><span class="s2">"</span></code> vs <code class="language-crystal highlighter-rouge"><span class="s2">"foo"</span> <span class="o">+</span> <span class="n">bar</span></code>.</p>

<p>There is a small breaking change though <code class="language-crystal highlighter-rouge"><span class="s2">"</span><span class="si">#{</span><span class="n">str</span><span class="si">}</span><span class="s2">"</span></code> returns the same string instance stored in <code class="language-crystal highlighter-rouge"><span class="n">str</span></code>. But since <code class="language-crystal highlighter-rouge"><span class="no">String</span></code> is immutable you should not worry about that change. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8400">#8400</a>.</p>

<p>For input parsing we have these cool new methods: <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="c1">#presence</span></code> (and <code class="language-crystal highlighter-rouge"><span class="no">Nil</span><span class="c1">#presence</span></code>). Here is an example of what they will let us do:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">puts</span> <span class="s2">"a"</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span> <span class="s2">"default"</span> <span class="c1"># =&gt; "a"</span>
<span class="nb">puts</span> <span class="kp">nil</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span> <span class="s2">"default"</span> <span class="c1"># =&gt; "default"</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8345">#8345</a>, <a href="https://github.com/crystal-lang/crystal/pull/8508">#8508</a></p>

<p>We will stop supporting <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="c1">#codepoint_at</span></code> in favor of <code class="language-crystal highlighter-rouge"><span class="no">String</span><span class="c1">#char_at(index).ord</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8475">#8475</a>.</p>

<h3 id="collections">Collections</h3>

<p>We won’t be using <code class="language-crystal highlighter-rouge"><span class="no">Enumerable</span><span class="c1">#grep</span></code> anymore.  Now we are just using <code class="language-crystal highlighter-rouge"><span class="no">Enumerable</span><span class="c1">#select</span></code>.</p>

<p>So, instead of:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">puts</span> <span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span> <span class="s2">"Bar"</span><span class="p">,</span> <span class="s2">"Baz"</span><span class="p">].</span><span class="nf">grep</span><span class="p">(</span><span class="sr">/^B/</span><span class="p">)</span> <span class="c1"># =&gt; ["Bar", "Baz"]</span>
</code></pre></div></div>

<p>We are going to use:</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="nb">puts</span> <span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span> <span class="s2">"Bar"</span><span class="p">,</span> <span class="s2">"Baz"</span><span class="p">].</span><span class="nf">select</span><span class="p">(</span><span class="sr">/^B/</span><span class="p">)</span> <span class="c1"># =&gt; ["Bar", "Baz"]</span>
<span class="c1"># or</span>
<span class="nb">puts</span> <span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span> <span class="s2">"Bar"</span><span class="p">,</span> <span class="s2">"Baz"</span><span class="p">].</span><span class="nf">select</span> <span class="p">{</span><span class="o">|</span><span class="n">word</span><span class="o">|</span> <span class="n">word</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"B"</span><span class="p">)}</span> <span class="c1"># =&gt; ["Bar", "Baz"]</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8452">#8452</a>.</p>

<p>With this version we may tell a <code class="language-crystal highlighter-rouge"><span class="no">Hash</span></code> (or a <code class="language-crystal highlighter-rouge"><span class="no">Set</span></code>) to compare <code class="language-crystal highlighter-rouge"><span class="n">keys</span></code> by <code class="language-crystal highlighter-rouge"><span class="nb">object_id</span></code>. After calling <code class="language-crystal highlighter-rouge"><span class="n">compare_by_identity</span></code> how the receiver hash behaves will change. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8451">#8451</a>.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">h1</span><span class="p">[</span><span class="s2">"fo"</span> <span class="o">+</span> <span class="s2">"o"</span><span class="p">]?</span> <span class="c1"># =&gt; 1</span>

<span class="n">h1</span><span class="p">.</span><span class="nf">compare_by_identity</span>
<span class="n">h1</span><span class="p">.</span><span class="nf">compare_by_identity?</span> <span class="c1"># =&gt; true</span>
<span class="n">h1</span><span class="p">[</span><span class="s2">"fo"</span> <span class="o">+</span> <span class="s2">"o"</span><span class="p">]?</span>         <span class="c1"># =&gt; nil # not the same String instance</span>
</code></pre></div></div>

<p>Iterating over an array with chunks of 2 elements? Well, we have a treat for you. Now we may use <code class="language-crystal highlighter-rouge"><span class="no">Enumerable</span><span class="c1">#each_cons_pair</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">Iterator</span><span class="c1">#cons_pair</span></code> with rocket-enhanced performance! Read more at <a href="https://github.com/crystal-lang/crystal/pull/8332">#8332</a>.</p>

<h3 id="serialization">Serialization</h3>

<p>While using <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="p">.</span><span class="nf">mapping</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="p">.</span><span class="nf">mapping</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">Serializable</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Serializable</span></code> sometimes the data is not quite in the right format or doesn’t quite match the type we expect. The <code class="language-crystal highlighter-rouge"><span class="n">converter</span></code> option allows you to inject some logic while converting from/to the different format. There are some new awesome helper modules: <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">ArrayConverter</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">ArrayConverter</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">HashValueConverter</span></code> that will allow to define the converters on the items or values to be used. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8156">#8156</a>.</p>

<p>If the above does not make you happy enough, wait until you discover <code class="language-crystal highlighter-rouge"><span class="n">use_json_discriminator</span></code> and <code class="language-crystal highlighter-rouge"><span class="n">use_yaml_discriminator</span></code>, that will allow you to specify which concrete type to use, based on a property value. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8406">#8406</a>.</p>

<p>Breaking news! <code class="language-crystal highlighter-rouge"><span class="no">XML</span><span class="o">::</span><span class="no">Reader</span><span class="c1">#expand</span></code> will raise an error, and if we want the old behavior then we have <code class="language-crystal highlighter-rouge"><span class="no">XML</span><span class="o">::</span><span class="no">Reader</span><span class="c1">#expand?</span></code> Making things more consistent! Read more at <a href="https://github.com/crystal-lang/crystal/pull/8186">#8186</a>.</p>

<h3 id="files">Files</h3>

<p>Breaking news! <code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">Path</span><span class="c1">#expand</span></code> will no longer expand home (<code class="language-crystal highlighter-rouge"><span class="o">~</span></code>) by default. It is now an opt-in argument: <code class="language-crystal highlighter-rouge"><span class="ss">home: </span><span class="kp">true</span></code> or even `home: “/use/this/as/home”. Read more at <a href="https://github.com/crystal-lang/crystal/pull/7903">#7903</a>.</p>

<h2 id="db">DB</h2>

<p><code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="o">-</span><span class="n">lang</span><span class="o">/</span><span class="n">crystal</span><span class="o">-</span><span class="n">db</span></code> got a new release: 0.8.0. The shiny new feature is the <code class="language-crystal highlighter-rouge"><span class="no">DB</span><span class="o">::</span><span class="no">Serializable</span></code> module and <code class="language-crystal highlighter-rouge"><span class="no">DB</span><span class="o">::</span><span class="no">Field</span></code> annotation matching the JSON and YAML counterparts. Read more at  <a href="https://github.com/crystal-lang/crystal-db/pull/115">crystal-db#115</a>.</p>

<p>If you want to use that feature be sure to upgrade to a driver that require 0.8.0 at least.</p>

<h2 id="next-steps">Next steps</h2>

<p>Please update your Crystal and report any issues. We will keep moving forward and start the development focusing on 0.33.</p>

<p>It will also be helpful if your shards are run against Crystal nightly releases. Either Docker or Snap are the current channels to get them easily. This will help reduce the friction of a release while checking if the ecosystem is in good shape.</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, and every other <a href="/sponsors">sponsor</a>. It is extremely important for us to sustain the support through donations, so that we can maintain this development pace. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!</p>


      </div>
      <div class="col m1"></div>
    </div>
  </div>
</main>


  <footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born & raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>

</div>


    <script src="/assets/js/bundle.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
