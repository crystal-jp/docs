<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Crystal 0.35.0 released! - The Crystal Programming Language</title>
    <meta charset='utf-8'>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'>
    <link href="/assets/stylesheet.css" rel="stylesheet" />
    <link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Crystal 0.35.0 released! | プログラミング言語 Crystal</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Crystal 0.35.0 released!" />
<meta name="author" content="bcardiff" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Crystal 0.35.0 has been released!" />
<meta property="og:description" content="Crystal 0.35.0 has been released!" />
<link rel="canonical" href="https://ja.crystal-lang.org/2020/06/09/crystal-0.35.0-released.html" />
<meta property="og:url" content="https://ja.crystal-lang.org/2020/06/09/crystal-0.35.0-released.html" />
<meta property="og:site_name" content="プログラミング言語 Crystal" />
<meta property="og:image" content="https://ja.crystal-lang.org/assets/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-09T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ja.crystal-lang.org/assets/icon.png" />
<meta property="twitter:title" content="Crystal 0.35.0 released!" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@bcardiff" />
<script type="application/ld+json">
{"datePublished":"2020-06-09T00:00:00+00:00","dateModified":"2020-06-09T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ja.crystal-lang.org/2020/06/09/crystal-0.35.0-released.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ja.crystal-lang.org/assets/media/crystal_logo.svg"},"name":"bcardiff"},"url":"https://ja.crystal-lang.org/2020/06/09/crystal-0.35.0-released.html","author":{"@type":"Person","name":"bcardiff"},"@type":"BlogPosting","image":"https://ja.crystal-lang.org/assets/icon.png","headline":"Crystal 0.35.0 released!","description":"Crystal 0.35.0 has been released!","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Let browser know website is optimized for mobile -->
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper ">
  <nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/conference/">
      Conference
    </a>
  </li>
<li>
    <a href="/team/">
      Team
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/conference/">
      Conference
    </a>
  </li>
<li>
    <a href="/team/">
      Team
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>


  <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/bcardiff.jpg" />
          
          
            <span class="author_name">Brian J. Cardiff</span>
          
          <span class="date">09 Jun 2020</span>
        </div>

        <h1 class='title'>Crystal 0.35.0 released!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>


<main>
  <div class="container">
    <div class="row post-layout">
      <div class="col m2 share">
        <p class="title small share-title">Share</p>
        <div class="share-list">
          
          <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fja.crystal-lang.org%2F2020%2F06%2F09%2Fcrystal-0.35.0-released.html&text=Crystal+0.35.0+released%21&via=CrystalLanguage" target="_blank">
            <div class="share-item"><i class="extra-icons twitter gray"></i></div>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fja.crystal-lang.org%2F2020%2F06%2F09%2Fcrystal-0.35.0-released.html" target="_blank">
            <div class="share-item"><i class="extra-icons facebook gray"></i></div>
          </a>
          <a href="https://plus.google.com/share?url=https%3A%2F%2Fja.crystal-lang.org%2F2020%2F06%2F09%2Fcrystal-0.35.0-released.html" target="_blank">
            <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
            </a>
        </div>
      </div>

      <div class="col s12 m9">
        <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.35.0">Crystal 0.35.0</a> has been released!</p>

<p>今回のリリースはみなさんの待ち望んでいた、1.0直前の標準ライブラリに磨きをかけるものです。この中には最近のいくつかの追加やより洗練された実装の繰り返しといった、多くの活動があります。他には、デバッグの改善や Windows のサポート、その他のプラットフォームでのランタイムの安定化などを含みます。</p>

<p>このリリースが最後のバージョン 0.x のリリースになるでしょう。1.0.0-preX のリリースに向けて準備をしていてください。</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.34.0...0.35.0">242 commits since 0.34.0</a> by 38 contributors.</p>

<p>それでは今回のリリースのハイライトを紹介していきます。たくさんの紹介するものがあります。Don’t miss out on the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.35.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="言語の変更">言語の変更</h2>

<h3 id="網羅性チェック-テイク2">網羅性チェック (テイク2)</h3>

<p><a href="/2020/04/06/crystal-0.34.0-released.html#exhaustive-case">前回のリリース</a>で、コンパイラは case 文の条件節の網羅性チェックをするようになりました。ですが、フィーバックを受けて、次のことを決定しました。</p>

<ol>
  <li><code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="o">...</span> <span class="k">when</span></code> を前のように戻す。暗黙の <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> があって、条件節は網羅的でなくてもよい。</li>
  <li><code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="o">...</span> <span class="k">in</span></code> 文を実験的に導入する。こちらは暗黙の <code class="language-crystal highlighter-rouge"><span class="k">else</span></code> を持たず、条件の網羅性が確認できなければコンパイルが通らない。実験的というのはフォードバックを元に変更される可能性がある、ということです。たとえマイナーリリースの間でも、その変更は行なわれる可能性があります。</li>
</ol>

<p>この決定によって <code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="o">...</span>  <span class="k">when</span></code> の意味は身近なままとなり、既存のコードに影響することなく網羅性チェックをする case 文を洗練させていくことが可能になります。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9258">#9258</a> and <a href="https://github.com/crystal-lang/crystal/pull/9045">#9045</a>.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="c1"># Compiles! Totally fine</span>
<span class="k">case</span> <span class="mi">1</span> <span class="o">||</span> <span class="s2">"a"</span>
<span class="k">when</span> <span class="no">Int32</span>
<span class="k">end</span>

<span class="c1"># Error: missing case String</span>
<span class="k">case</span> <span class="mi">1</span> <span class="o">||</span> <span class="s2">"a"</span>
<span class="k">in</span> <span class="no">Int32</span>
<span class="k">end</span>
</code></pre></div></div>

<p>この変更によって <code class="language-crystal highlighter-rouge"><span class="k">in</span></code> が正式なキーワードとなりました。これは破壊的な変更ですが、<code class="language-crystal highlighter-rouge"><span class="k">in</span></code> はこれまでもマクロ中ではキーワードとして扱われていました。</p>

<h2 id="コンパイラ">コンパイラ</h2>

<p>コンパイラに破壊的な変更があり、コンパイラの CLI がシバン <code class="language-crystal highlighter-rouge"><span class="c1">#!</span></code> によるスクリプトをより安心して動作させられるようになりました。これからは、コマンドの代わりにファイルを引数にしてコンパイラを実行すると (<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="nf">cr</span> <span class="n">arg1</span> <span class="n">arg2</span></code> のように)、ファイルがコンパイルされて、そしてそれを実行する、という動作をします。このとき、引数はプログラムにだけ影響して、コンパイラに影響しない、ということです。</p>

<p>コンパイラフラグを使いたい場合や引数と共にプログラムを実行したい場合は、次のように run コマンドが使えます。<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">run</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="nf">cr</span> <span class="o">-</span><span class="no">Dcompiler_flag</span> <span class="o">--</span><span class="n">release</span> <span class="o">--</span> <span class="n">arg1</span> <span class="n">arg2</span></code><code class="language-crystal highlighter-rouge"><span class="o">--</span></code> はコンパイラのオプションとプログラムのオプションを切り分けます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9171">#9171</a>.</p>

<p>他の破壊的な変更としては、<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">env</span></code> がシェル向けにクオートをするようになりました。つまり、<code class="language-crystal highlighter-rouge"><span class="nb">eval</span> <span class="s2">"$(crystal env)"</span></code> が安全にできるようになったということです。また、<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">env</span> <span class="no">VARIABLE</span></code> はこれまでの通りです。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9428">#9428</a></p>

<p>パーサーはたくさんの愛を受けました。Fixing edge cases, bugs and even a considerable refactor in <a href="https://github.com/crystal-lang/crystal/pull/9208">#9208</a>.</p>

<p>言語のいくつかの機能はより良い動作のために反芻が必要でした。このリリースではオートキャストが多重ディスパッチやユニオンのデフォルト値に対して動作するようになりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9004">#9004</a> and <a href="https://github.com/crystal-lang/crystal/pull/9366">#9366</a>. これはいくつかの場合の予期しない残念な挙動を解決するでしょう。</p>

<p>既存の機能の改善の背景には、Crystal のデバッグ機能の改善を待ち望まれていたことがあります。The story is not yet complete, but in <a href="https://github.com/crystal-lang/crystal/pull/8538">#8538</a> a huge step forward was made. You can check out an article about <a href="https://dev.to/bcardiff/debug-crystal-in-vscode-via-codelldb-3lf">how to debug a Crystal program in VS Code article</a> for more information, configuration and screenshots.</p>

<p><code class="language-crystal highlighter-rouge"><span class="nd">@[Link]</span></code> アノテーションは少しだけ再デザインされました。pkg-config とより統合されて、<code class="language-crystal highlighter-rouge"><span class="n">static</span><span class="p">:</span></code> オプションのサポートが無くなりました。これによって将来、デフォルト値をいい感じに提供しつつ、リンクを詳細に設定できるようにすることを見据えています。Read more at <a href="https://github.com/crystal-lang/crystal/pull/8972">#8972</a>.</p>

<p><strong>Crystal パッケージのメンテナにとって</strong>、コンパイラをビルドする際に<code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_CONFIG_PATH</span></code> が標準ライブラリのパスのみを必要とするようになったという知らせは価値があるでしょう。<code class="language-crystal highlighter-rouge"><span class="k">lib</span></code> ディレクトリはコンパイラによって常に含まれるようになりました。将来的には shaeds のインストールパスを細かく設定できるようにしたいと考えています。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9315">#9315</a>.</p>

<p>その他の変更として、<code class="language-crystal highlighter-rouge"><span class="no">SOURCE_DATE_EPOCH</span></code> という環境変数を使うことでコンパイラをビルドする際にソースコードの時刻を伝えることができるようになりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9088">#9088</a>.</p>

<h2 id="shards">Shards</h2>

<p>Shards v0.11.1 が今回のリリースではバンドルされます。</p>

<p>今回の把握すべき主要な変更は <code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="p">:</span></code> プロパティが<strong>効果的に機能する</strong>ようになった点です。このプロパティは、有効な shard のバージョンを Crystal 環境に基いて決定するのに使われます。You can check the semantics in <a href="https://github.com/crystal-lang/shards/blob/v0.11.1/SPEC.md#crystal">shards/SPEC.md</a>.</p>

<p>後方互換性のために <code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="p">:</span></code> プロパティが <code class="language-crystal highlighter-rouge"><span class="n">shard</span><span class="p">.</span><span class="nf">yml</span></code> に無かった場合、<code class="language-crystal highlighter-rouge"><span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span></code>として解釈されます。よって、Crystal 1.0.0 まではそのままでも動作し続けるでしょう。また、この挙動が不便な場合は、<code class="language-crystal highlighter-rouge"><span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">crystal</span><span class="o">-</span><span class="n">version</span></code> を渡すことでこのチェックを無視できます。</p>

<p>利用者の期待を高めるには、依存するバージョンを明示する必要があると考えられます。そして、標準ライブラリや言語のバージョンもまた依存関係なのです。</p>

<p><code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="p">:</span></code> プロパティの動作は依存関係のバージョン指定とほとんど同じように動作します。違いは、利便性のため <code class="language-crystal highlighter-rouge"><span class="ss">crystal: </span><span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">.</span><span class="nf">z</span></code> が <code class="language-crystal highlighter-rouge"><span class="o">~&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">.</span><span class="nf">z</span></code> のように (つまり、 <code class="language-crystal highlighter-rouge"><span class="o">&gt;=</span> <span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">.</span><span class="nf">z</span><span class="p">,</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="mf">0.0</span></code>) 解釈されることです。この結果、任意の<strong>メジャー</strong>リリースで何らかの対応が必要になります。</p>

<p><code class="language-crystal highlighter-rouge"><span class="n">shards</span> <span class="n">install</span></code> を現在のプロジェクトで実行することを推奨します。これによって、<code class="language-crystal highlighter-rouge"><span class="n">shard</span><span class="p">.</span><span class="nf">lock</span></code> がいくつかの追加の新しいバージョンのフォーマットを持つことに気付くかもしれません。そして、<code class="language-crystal highlighter-rouge"><span class="k">lib</span><span class="sr">/.shards.info</span></code> ファイルがインストールした依存関係を説明するものとして追加されています。この新しいファイルはバージョン管理システムでトラックする必要はありません。</p>

<p>最後に、依存関係のバージョン指定で <code class="language-crystal highlighter-rouge"><span class="ss">version: </span><span class="o">&gt;=</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">&lt;</span> <span class="mf">2.0</span></code> のように複数の指定を交差させられるようになったことを紹介します。</p>

<p>For a comprehensive list of changes in this shards version you can check its <a href="https://github.com/crystal-lang/shards/releases/tag/v0.11.0">changelog</a>.</p>

<h2 id="標準ライブラリ">標準ライブラリ</h2>

<p>このリリースにはいくつもの破壊的変更が含まれます。それらの大半は普通、非推奨の警告が出るようになっています。標準ライブラリの整理なしに1.0へと進むことはないつもりです。このような整理は以前にもあったはずです。これに優先順位を付けることは簡単ではなく、地道に進めています。</p>

<p>計算結果の出力や入力に <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> を引数に取る多くのメソッドがあります。In <a href="https://github.com/crystal-lang/crystal/issues/5916">#5916</a> you can read the motivation to standardize them as the first argument in these functions. It got implemented in <a href="https://github.com/crystal-lang/crystal/pull/9134">#9134</a> and some follow up PRs.</p>

<p>Related to all these <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> methods, on <code class="language-crystal highlighter-rouge"><span class="no">String</span></code>, instead of returning <code class="language-crystal highlighter-rouge"><span class="no">String</span></code> values, there are new overloads to emit directly the result to the <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code>; read more in <a href="https://github.com/crystal-lang/crystal/pull/9236">#9236</a>. この影響を受けるのは <code class="language-crystal highlighter-rouge"><span class="c1">#underscore</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#titleize</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#capitalize</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#upcase</span></code>、そして<code class="language-crystal highlighter-rouge"><span class="c1">#downcase</span></code> といったメソッドです。</p>

<blockquote>
  <p>Keep an eye on <a href="https://github.com/crystal-lang/crystal/issues/9291">#9291</a> for a proposal to improve the interpolation of strings so they can emit directly to an <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code>.</p>
</blockquote>

<p>その他の <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> の破壊的な変更としては、<code class="language-crystal highlighter-rouge"><span class="c1">#skip</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write_utf8</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write_byte</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write_bytes</span></code>、や<code class="language-crystal highlighter-rouge"><span class="c1">#skip_to_end</span></code> がスキップした/書き込んだバイト数の数値を返すようになったことがあります。これは他の言語でもそのようになっており、書き込み中に追加の呼び出しなく現在のストリームを位置を把握できるようになります。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9233">#9233</a> and <a href="https://github.com/crystal-lang/crystal/pull/9363">#9363</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="nd">@[Experimental]</span></code> アノテーションという、ライブラリや言語、shardの部分に細心の注意と共に使う必要のあるという指定をするためのものが導入されました。実験的な (experimental) 機能は変更や破壊、もしくは削除を Semver の規約に関わらず行なっても良いものとします。今のところ、アノテーションはドキュメントジェネレータで利用されています。ですが、他にも追加の機能のアイディアがあります。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9244">#9244</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="no">Digest</span></code> 型がリファクタリングされて、いくつかのメソッドの名前が変更されたことに注意する必要があるかもしれません。Read more at <a href="https://github.com/crystal-lang/crystal/pull/8426">#8426</a>.</p>

<p>さて、<code class="language-crystal highlighter-rouge"><span class="no">OptionParser</span></code> がサブコマンドを定義できるようになりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9009">#9009</a>.</p>

<p>Some other clean-ups: <code class="language-crystal highlighter-rouge"><span class="no">Flate</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">Gzip</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">Zip</span></code>, and <code class="language-crystal highlighter-rouge"><span class="no">Zlib</span></code> were moved inside <code class="language-crystal highlighter-rouge"><span class="no">Compress</span></code> module in <a href="https://github.com/crystal-lang/crystal/pull/8886">#8886</a>. また、<code class="language-crystal highlighter-rouge"><span class="no">Flate</span></code> は <code class="language-crystal highlighter-rouge"><span class="no">Compress</span><span class="o">::</span><span class="no">Deflate</span></code> に名前が変更されています。<code class="language-crystal highlighter-rouge"><span class="nb">require</span> <span class="s2">"compress/gzip"</span></code> として、これらの定数を変更する必要があります。<code class="language-crystal highlighter-rouge"><span class="nb">require</span> <span class="s2">"gzip"</span></code> は依然として有効ですが、警告メッセージが表示されることになります。</p>

<p>いくつかの変更が <code class="language-crystal highlighter-rouge"><span class="no">File</span></code> と <code class="language-crystal highlighter-rouge"><span class="no">FileUtils</span></code> にあります。これらは整理されて、強制する操作が両方の API で有効になりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9175">#9175</a>.</p>

<h3 id="マクロ">マクロ</h3>

<p>クロスコンパイルの際、<code class="language-crystal highlighter-rouge"><span class="n">host_flag?</span></code> というマクロが追加されたことを知っておくと便利でしょう。これは <code class="language-crystal highlighter-rouge"><span class="n">flag?</span></code> のようなものですが、ホストのマシンで解決されます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9049">#9049</a>.</p>

<h3 id="数値計算">数値計算</h3>

<p>符号付きと符号無しの数値の混ざった演算のオーバーフローの検出が修正されました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9403">#9403</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="no">Int</span><span class="c1">#digits</span></code> というメソッドが追加されて、一貫性のため <code class="language-crystal highlighter-rouge"><span class="no">BigInt</span><span class="c1">#digits</span></code> の出力が反転されました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9383">#9383</a>.</p>

<h3 id="シリアライズ">シリアライズ</h3>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="p">.</span><span class="nf">mapping</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="p">.</span><span class="nf">mapping</span></code> migrated to their own packages: <a href="https://github.com/crystal-lang/json_mapping.cr">github:crystal-lang/json_mapping.cr</a> and <a href="https://github.com/crystal-lang/yaml_mapping.cr">github:crystal-lang/yaml_mapping.cr</a>. これらの機能は十分なものでしたが、現在は <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">Serializable</span></code> と <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Serializable</span></code> がより良いものとしてあるため、標準ライブラリから削除されました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9272">#9272</a>.</p>

<h3 id="時刻">時刻</h3>

<p>これからは <code class="language-crystal highlighter-rouge"><span class="no">Time</span><span class="c1">#to_rfc3339</span></code> のデフォルトの精度は秒となり、それ以上の精度は出力されません。より細かな精度が必要な場合は <code class="language-crystal highlighter-rouge"><span class="n">fraction_digits</span></code> という名前付き引数に 0. 3, 6, 9 という精度の桁数を指定してください。In <a href="https://github.com/crystal-lang/crystal/pull/9283">#9283</a> we are dropping the logic to show the fraction of seconds depending on the time value.</p>

<h3 id="ネットワーク">ネットワーク</h3>

<p>We’ve updated the SSL server secure defaults in <a href="https://github.com/crystal-lang/crystal/pull/9026">#9026</a>. And fixed some <code class="language-crystal highlighter-rouge"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span></code> sporadic failures during SSL handshake in <a href="https://github.com/crystal-lang/crystal/pull/9177">#9177</a>.</p>

<p>そして、<code class="language-crystal highlighter-rouge"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span></code>に2つの破壊的な変更があります。We improved the error handling and logging in <a href="https://github.com/crystal-lang/crystal/pull/9115">#9115</a> and integrated it with the new logging module. The <code class="language-crystal highlighter-rouge"><span class="no">HTTP</span><span class="o">::</span><span class="no">Request</span><span class="c1">#remote_address</span></code> type was changed to <code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">Address</span><span class="p">?</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/9210">#9210</a>.</p>

<h3 id="ログ">ログ</h3>

<p>まず初めに、<a href="/2020/04/06/crystal-0.34.0-released.html">0.34.0</a>で導入した新しいログモジールを早期に試してフィードバックを送ってくださった皆様に感謝いたします。破壊的な変更を含むいくつかの変更点がありますが、それらは主要な API には影響しません。これらを組み合わせることで、追加の機能といくつかのユースケースでのパーフォマンスの改善を達成しています。</p>

<p>We renamed <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Severity</span><span class="o">::</span><span class="no">Warning</span></code> to <code class="language-crystal highlighter-rouge"><span class="no">Warn</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/9293">#9293</a>. <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">warn</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span></code> がありましたが、これはそのままで、警告を表します。。この変更は <code class="language-crystal highlighter-rouge"><span class="ss">:warning</span></code> やほとんどの環境変数経由での設定に影響します。Similarly, we dropped <code class="language-crystal highlighter-rouge"><span class="no">Verbose</span></code>, and added <code class="language-crystal highlighter-rouge"><span class="no">Trace</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">Notice</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/9107">#9107</a>.</p>

<p>ログのセットアップがよりシンプルになりました。<code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">setup</span><span class="o">*</span></code> 系の2つのメソッドがあります。これらのメソッドは常にソースとバックエンドの間のバインディングを完全に設定するでしょう。</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">Log</span><span class="p">.</span><span class="nf">setup</span> <span class="ss">:debug</span> <span class="c1"># will show debug or above in the stdout for all source</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">setup</span> <span class="s2">"db.*"</span><span class="p">,</span> <span class="ss">:trace</span> <span class="c1"># will show trace or above in the stdout for db.* sources and nothing else</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span> <span class="c1"># will grab the value of LOG_LEVEL env variable</span>
</code></pre></div></div>

<p><code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span></code> が1つの環境変数を受け取って動作するようになったことにも注意してください。より柔軟なものが今後追加されるかもしれませんが、名前付き引数はより良い体験を提供するはずです。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9145">#9145</a>.</p>

<p>各エントリはこれまでより、現在実行しているファイバーから取得したコンテキストの情報を持っていました。その <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Context</span></code> の責務を <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span></code> と <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span><span class="o">::</span><span class="no">Value</span></code> に分割することにしました。前者は<code class="language-crystal highlighter-rouge"><span class="no">Symbol</span></code> から <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span><span class="o">::</span><span class="no">Value</span></code> へのハッシュのようなデータ構造ですが、アロケーションやアルゴリズム的な最適化がされています。The main work was done in <a href="https://github.com/crystal-lang/crystal/pull/9227">#9227</a> and <a href="https://github.com/crystal-lang/crystal/pull/9295">#9295</a>. これらのリファクタリングによって、クローンによって獲得していた <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span><span class="o">::</span><span class="no">Value</span></code> の不変性 (immutability) が無くなりました。</p>

<p>ログエントリにローカルのメタデータや構造化された情報を追加したいという機能が望まれていました。もちろん、現在のファイバのコンテキストに対する変更や復旧が最小であるものが望ましいです。エントリが出力されていない場合は値の生成を省略するという当初の設計を保って、これを達成しました。</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="p">{</span> <span class="s2">"Program started"</span> <span class="p">}</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"Program started"</span><span class="p">)</span> <span class="c1"># same as previous</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"User logged in"</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">42</span><span class="p">)</span> <span class="c1"># local data</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"User logged in"</span><span class="p">,</span> <span class="n">expr_that_computes_hash_named_tuple_or_metadata</span><span class="p">)</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">warn</span> <span class="ss">exception: </span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"Oh no!"</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">42</span><span class="p">)</span> <span class="c1"># with exception</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">warn</span> <span class="ss">exception: </span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"Oh no!"</span><span class="p">)</span> <span class="c1"># with exception, no local data</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="ss">exception: </span><span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"Oh no!"</span> <span class="p">}</span> <span class="c1"># same as previous</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="ss">action: </span><span class="s2">"log_in"</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">42</span><span class="p">)</span> <span class="c1"># empty message</span>
</code></pre></div></div>

<p>How to create custom log formatters was revisited in <a href="https://github.com/crystal-lang/crystal/pull/9211">#9211</a>. ブロックや Proc からフォーマッタを作る方法はまだ利用できますが、文字列から直接フォーマッタを定義するシンプルな方法を確認してみてください。</p>

<p>出力するログのエントリーをテストしたい場合、新しく追加された <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">capture</span></code> というヘルパーが利用できます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9201">#9201</a>.</p>

<h3 id="並行処理">並行処理</h3>

<p><code class="language-crystal highlighter-rouge"><span class="no">Concurrent</span><span class="o">::</span><span class="no">Future</span></code> とトップレベルの <code class="language-crystal highlighter-rouge"><span class="n">delay</span></code>、<code class="language-crystal highlighter-rouge"><span class="n">future</span></code>、<code class="language-crystal highlighter-rouge"><span class="n">lazy</span></code> を削除しました。If you want to keep using them, use the <a href="https://github.com/crystal-community/future.cr">github:crystal-community/future.cr</a> shard. Read more at <a href="https://github.com/crystal-lang/crystal/pull/9093">#9093</a>.</p>

<p>Another feature that was dropped is the <code class="language-crystal highlighter-rouge"><span class="n">parallel</span></code> macro in <a href="https://github.com/crystal-lang/crystal/pull/9097">#9097</a>.</p>

<p>1.0 以降に向けて、より堅牢で様々な利用に耐えうるもの開発したいと考えています。</p>

<h3 id="ランタイム">ランタイム</h3>

<p><code class="language-crystal highlighter-rouge"><span class="no">Process</span><span class="c1">#signal</span></code> があるので <code class="language-crystal highlighter-rouge"><span class="no">Process</span><span class="c1">#kill</span></code> を非推奨としました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9006">#9006</a>.</p>

<p>また <code class="language-crystal highlighter-rouge"><span class="nb">fork</span></code> も非推奨となりました。これはマルチスレッド環境では有効ではありません。この変更が問題である場合は、<code class="language-crystal highlighter-rouge"><span class="no">Process</span><span class="p">.</span><span class="nf">fork</span></code> はまだ利用できるのでそちらを使ってください。しかし、このメソッドはもはや公開された API ではありません。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9136">#9136</a>.</p>

<h3 id="プラットフォーム">プラットフォーム</h3>

<p>For macOS users, we fixed some compatibility issues with 10.15 (Catalina) in <a href="https://github.com/crystal-lang/crystal/pull/9296">#9296</a>.</p>

<p>For BSD users, we added support for DragonFly(BSD) in <a href="https://github.com/crystal-lang/crystal/pull/9178">#9178</a>.</p>

<p>For musl users, we fixed some weird segfaults in <a href="https://github.com/crystal-lang/crystal/pull/9238">#9238</a> and fixed some empty backtraces <a href="https://github.com/crystal-lang/crystal/pull/9267">#9267</a>.</p>

<p>Windows ユーザーへはたくさんのお知らせがあります。To see the ongoing efforts don’t miss the <a href="https://github.com/crystal-lang/crystal/wiki/Porting-to-Windows">wiki page</a> and <a href="https://github.com/crystal-lang/crystal/issues/5430">#5430</a>.</p>

<p>今回のリリースでの Windows 向けの変更としては次のようなものがあります。</p>

<ul>
  <li><code class="language-crystal highlighter-rouge"><span class="no">File</span></code> improvements <a href="https://github.com/crystal-lang/crystal/pull/9015">#9015</a>, <a href="https://github.com/crystal-lang/crystal/pull/9038">#9038</a>, <a href="https://github.com/crystal-lang/crystal/pull/9037">#9037</a>, <a href="https://github.com/crystal-lang/crystal/pull/9257">#9257</a>.</li>
  <li><code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> behaviour was aligned in <a href="https://github.com/crystal-lang/crystal/pull/9207">#9207</a>.</li>
  <li><code class="language-crystal highlighter-rouge"><span class="no">Process</span></code> was implemented <a href="https://github.com/crystal-lang/crystal/pull/9047">#9047</a>, <a href="https://github.com/crystal-lang/crystal/pull/9021">#9021</a>, <a href="https://github.com/crystal-lang/crystal/pull/9122">#9122</a>, <a href="https://github.com/crystal-lang/crystal/pull/9112">#9112</a>, <a href="https://github.com/crystal-lang/crystal/pull/9149">#9149</a>, <a href="https://github.com/crystal-lang/crystal/pull/9310">#9310</a></li>
  <li><code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">spec</span></code> command deals with Windows paths in <a href="https://github.com/crystal-lang/crystal/pull/9234">#9234</a></li>
  <li>そして、コンパイラ自身を Windows 上でブートストラップできるようになりました。<a href="https://github.com/crystal-lang/crystal/pull/9054">#9054</a>, <a href="https://github.com/crystal-lang/crystal/pull/9062">#9062</a>, <a href="https://github.com/crystal-lang/crystal/pull/9095">#9095</a>, <a href="https://github.com/crystal-lang/crystal/pull/9106">#9106</a>, <a href="https://github.com/crystal-lang/crystal/pull/9307">#9307</a>.</li>
</ul>

<p>ですが、まだ標準ライブラリのすべての部分が Windows で利用できるというというわけではないことには注意してください。</p>

<h3 id="ツール">ツール</h3>

<p>主要な変更はドキュメントジェネレータで、バージョンピッカーをサポートするようになりました。外部に <code class="language-crystal highlighter-rouge"><span class="p">.</span><span class="nf">json</span></code> ファイルを用意して、現在と過去のリリースを指定することでバージョンピッカーに反映できます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/8792">#8792</a>, <a href="https://github.com/crystal-lang/crystal/pull/9074">#9074</a>, and <a href="https://github.com/crystal-lang/crystal/pull/9254">#9254</a>.</p>

<h2 id="次のステップ">次のステップ</h2>

<p>Crystal をアップデートしてください。そして、問題の報告を心待ちにしています。私たちは1.0.0に向けての開発を始めています。1.0.0-preX のようなリリースをして、最終的な調整を重ねていくでしょう。</p>

<p>ここ数回のリリースで修正が多かったことは認めます。ですが、不快感は最小になるように心掛けたつもりです。</p>

<p>すべての非推奨にした定義は1.0では削除される予定です。1.0をクリーンなバージョンにしたいと思っています。</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, <a href="https://nikolamotor.com/">Nikola Motor Company</a> and every other <a href="/sponsors">sponsor</a>. 継続的に開発・メンテナンスを続けていくには、寄付が不可欠です。<a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Crystal の直接のスポンサーになりたい場合や、他のサポート方法を探している場合は <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> に連絡してください。それでは、ここまで読んでいただきありがとうございます！</p>


      </div>
      <div class="col m1"></div>
    </div>

    <div class="row disqus">
      <div class="col m2"></div>
      <div class="col s12 m9" id='disqus_thread'>
        <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.35.0">Crystal 0.35.0</a> has been released!</p>

<p>今回のリリースはみなさんの待ち望んでいた、1.0直前の標準ライブラリに磨きをかけるものです。この中には最近のいくつかの追加やより洗練された実装の繰り返しといった、多くの活動があります。他には、デバッグの改善や Windows のサポート、その他のプラットフォームでのランタイムの安定化などを含みます。</p>

<p>このリリースが最後のバージョン 0.x のリリースになるでしょう。1.0.0-preX のリリースに向けて準備をしていてください。</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.34.0...0.35.0">242 commits since 0.34.0</a> by 38 contributors.</p>

<p>それでは今回のリリースのハイライトを紹介していきます。たくさんの紹介するものがあります。Don’t miss out on the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.35.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="言語の変更">言語の変更</h2>

<h3 id="網羅性チェック-テイク2">網羅性チェック (テイク2)</h3>

<p><a href="/2020/04/06/crystal-0.34.0-released.html#exhaustive-case">前回のリリース</a>で、コンパイラは case 文の条件節の網羅性チェックをするようになりました。ですが、フィーバックを受けて、次のことを決定しました。</p>

<ol>
  <li><code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="o">...</span> <span class="k">when</span></code> を前のように戻す。暗黙の <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> があって、条件節は網羅的でなくてもよい。</li>
  <li><code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="o">...</span> <span class="k">in</span></code> 文を実験的に導入する。こちらは暗黙の <code class="language-crystal highlighter-rouge"><span class="k">else</span></code> を持たず、条件の網羅性が確認できなければコンパイルが通らない。実験的というのはフォードバックを元に変更される可能性がある、ということです。たとえマイナーリリースの間でも、その変更は行なわれる可能性があります。</li>
</ol>

<p>この決定によって <code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="o">...</span>  <span class="k">when</span></code> の意味は身近なままとなり、既存のコードに影響することなく網羅性チェックをする case 文を洗練させていくことが可能になります。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9258">#9258</a> and <a href="https://github.com/crystal-lang/crystal/pull/9045">#9045</a>.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="c1"># Compiles! Totally fine</span>
<span class="k">case</span> <span class="mi">1</span> <span class="o">||</span> <span class="s2">"a"</span>
<span class="k">when</span> <span class="no">Int32</span>
<span class="k">end</span>

<span class="c1"># Error: missing case String</span>
<span class="k">case</span> <span class="mi">1</span> <span class="o">||</span> <span class="s2">"a"</span>
<span class="k">in</span> <span class="no">Int32</span>
<span class="k">end</span>
</code></pre></div></div>

<p>この変更によって <code class="language-crystal highlighter-rouge"><span class="k">in</span></code> が正式なキーワードとなりました。これは破壊的な変更ですが、<code class="language-crystal highlighter-rouge"><span class="k">in</span></code> はこれまでもマクロ中ではキーワードとして扱われていました。</p>

<h2 id="コンパイラ">コンパイラ</h2>

<p>コンパイラに破壊的な変更があり、コンパイラの CLI がシバン <code class="language-crystal highlighter-rouge"><span class="c1">#!</span></code> によるスクリプトをより安心して動作させられるようになりました。これからは、コマンドの代わりにファイルを引数にしてコンパイラを実行すると (<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="nf">cr</span> <span class="n">arg1</span> <span class="n">arg2</span></code> のように)、ファイルがコンパイルされて、そしてそれを実行する、という動作をします。このとき、引数はプログラムにだけ影響して、コンパイラに影響しない、ということです。</p>

<p>コンパイラフラグを使いたい場合や引数と共にプログラムを実行したい場合は、次のように run コマンドが使えます。<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">run</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="nf">cr</span> <span class="o">-</span><span class="no">Dcompiler_flag</span> <span class="o">--</span><span class="n">release</span> <span class="o">--</span> <span class="n">arg1</span> <span class="n">arg2</span></code><code class="language-crystal highlighter-rouge"><span class="o">--</span></code> はコンパイラのオプションとプログラムのオプションを切り分けます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9171">#9171</a>.</p>

<p>他の破壊的な変更としては、<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">env</span></code> がシェル向けにクオートをするようになりました。つまり、<code class="language-crystal highlighter-rouge"><span class="nb">eval</span> <span class="s2">"$(crystal env)"</span></code> が安全にできるようになったということです。また、<code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">env</span> <span class="no">VARIABLE</span></code> はこれまでの通りです。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9428">#9428</a></p>

<p>パーサーはたくさんの愛を受けました。Fixing edge cases, bugs and even a considerable refactor in <a href="https://github.com/crystal-lang/crystal/pull/9208">#9208</a>.</p>

<p>言語のいくつかの機能はより良い動作のために反芻が必要でした。このリリースではオートキャストが多重ディスパッチやユニオンのデフォルト値に対して動作するようになりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9004">#9004</a> and <a href="https://github.com/crystal-lang/crystal/pull/9366">#9366</a>. これはいくつかの場合の予期しない残念な挙動を解決するでしょう。</p>

<p>既存の機能の改善の背景には、Crystal のデバッグ機能の改善を待ち望まれていたことがあります。The story is not yet complete, but in <a href="https://github.com/crystal-lang/crystal/pull/8538">#8538</a> a huge step forward was made. You can check out an article about <a href="https://dev.to/bcardiff/debug-crystal-in-vscode-via-codelldb-3lf">how to debug a Crystal program in VS Code article</a> for more information, configuration and screenshots.</p>

<p><code class="language-crystal highlighter-rouge"><span class="nd">@[Link]</span></code> アノテーションは少しだけ再デザインされました。pkg-config とより統合されて、<code class="language-crystal highlighter-rouge"><span class="n">static</span><span class="p">:</span></code> オプションのサポートが無くなりました。これによって将来、デフォルト値をいい感じに提供しつつ、リンクを詳細に設定できるようにすることを見据えています。Read more at <a href="https://github.com/crystal-lang/crystal/pull/8972">#8972</a>.</p>

<p><strong>Crystal パッケージのメンテナにとって</strong>、コンパイラをビルドする際に<code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_CONFIG_PATH</span></code> が標準ライブラリのパスのみを必要とするようになったという知らせは価値があるでしょう。<code class="language-crystal highlighter-rouge"><span class="k">lib</span></code> ディレクトリはコンパイラによって常に含まれるようになりました。将来的には shaeds のインストールパスを細かく設定できるようにしたいと考えています。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9315">#9315</a>.</p>

<p>その他の変更として、<code class="language-crystal highlighter-rouge"><span class="no">SOURCE_DATE_EPOCH</span></code> という環境変数を使うことでコンパイラをビルドする際にソースコードの時刻を伝えることができるようになりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9088">#9088</a>.</p>

<h2 id="shards">Shards</h2>

<p>Shards v0.11.1 が今回のリリースではバンドルされます。</p>

<p>今回の把握すべき主要な変更は <code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="p">:</span></code> プロパティが<strong>効果的に機能する</strong>ようになった点です。このプロパティは、有効な shard のバージョンを Crystal 環境に基いて決定するのに使われます。You can check the semantics in <a href="https://github.com/crystal-lang/shards/blob/v0.11.1/SPEC.md#crystal">shards/SPEC.md</a>.</p>

<p>後方互換性のために <code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="p">:</span></code> プロパティが <code class="language-crystal highlighter-rouge"><span class="n">shard</span><span class="p">.</span><span class="nf">yml</span></code> に無かった場合、<code class="language-crystal highlighter-rouge"><span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span></code>として解釈されます。よって、Crystal 1.0.0 まではそのままでも動作し続けるでしょう。また、この挙動が不便な場合は、<code class="language-crystal highlighter-rouge"><span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">crystal</span><span class="o">-</span><span class="n">version</span></code> を渡すことでこのチェックを無視できます。</p>

<p>利用者の期待を高めるには、依存するバージョンを明示する必要があると考えられます。そして、標準ライブラリや言語のバージョンもまた依存関係なのです。</p>

<p><code class="language-crystal highlighter-rouge"><span class="n">crystal</span><span class="p">:</span></code> プロパティの動作は依存関係のバージョン指定とほとんど同じように動作します。違いは、利便性のため <code class="language-crystal highlighter-rouge"><span class="ss">crystal: </span><span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">.</span><span class="nf">z</span></code> が <code class="language-crystal highlighter-rouge"><span class="o">~&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">.</span><span class="nf">z</span></code> のように (つまり、 <code class="language-crystal highlighter-rouge"><span class="o">&gt;=</span> <span class="n">x</span><span class="p">.</span><span class="nf">y</span><span class="p">.</span><span class="nf">z</span><span class="p">,</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="mf">0.0</span></code>) 解釈されることです。この結果、任意の<strong>メジャー</strong>リリースで何らかの対応が必要になります。</p>

<p><code class="language-crystal highlighter-rouge"><span class="n">shards</span> <span class="n">install</span></code> を現在のプロジェクトで実行することを推奨します。これによって、<code class="language-crystal highlighter-rouge"><span class="n">shard</span><span class="p">.</span><span class="nf">lock</span></code> がいくつかの追加の新しいバージョンのフォーマットを持つことに気付くかもしれません。そして、<code class="language-crystal highlighter-rouge"><span class="k">lib</span><span class="sr">/.shards.info</span></code> ファイルがインストールした依存関係を説明するものとして追加されています。この新しいファイルはバージョン管理システムでトラックする必要はありません。</p>

<p>最後に、依存関係のバージョン指定で <code class="language-crystal highlighter-rouge"><span class="ss">version: </span><span class="o">&gt;=</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">&lt;</span> <span class="mf">2.0</span></code> のように複数の指定を交差させられるようになったことを紹介します。</p>

<p>For a comprehensive list of changes in this shards version you can check its <a href="https://github.com/crystal-lang/shards/releases/tag/v0.11.0">changelog</a>.</p>

<h2 id="標準ライブラリ">標準ライブラリ</h2>

<p>このリリースにはいくつもの破壊的変更が含まれます。それらの大半は普通、非推奨の警告が出るようになっています。標準ライブラリの整理なしに1.0へと進むことはないつもりです。このような整理は以前にもあったはずです。これに優先順位を付けることは簡単ではなく、地道に進めています。</p>

<p>計算結果の出力や入力に <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> を引数に取る多くのメソッドがあります。In <a href="https://github.com/crystal-lang/crystal/issues/5916">#5916</a> you can read the motivation to standardize them as the first argument in these functions. It got implemented in <a href="https://github.com/crystal-lang/crystal/pull/9134">#9134</a> and some follow up PRs.</p>

<p>Related to all these <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> methods, on <code class="language-crystal highlighter-rouge"><span class="no">String</span></code>, instead of returning <code class="language-crystal highlighter-rouge"><span class="no">String</span></code> values, there are new overloads to emit directly the result to the <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code>; read more in <a href="https://github.com/crystal-lang/crystal/pull/9236">#9236</a>. この影響を受けるのは <code class="language-crystal highlighter-rouge"><span class="c1">#underscore</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#titleize</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#capitalize</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#upcase</span></code>、そして<code class="language-crystal highlighter-rouge"><span class="c1">#downcase</span></code> といったメソッドです。</p>

<blockquote>
  <p>Keep an eye on <a href="https://github.com/crystal-lang/crystal/issues/9291">#9291</a> for a proposal to improve the interpolation of strings so they can emit directly to an <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code>.</p>
</blockquote>

<p>その他の <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> の破壊的な変更としては、<code class="language-crystal highlighter-rouge"><span class="c1">#skip</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write_utf8</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write_byte</span></code>、<code class="language-crystal highlighter-rouge"><span class="c1">#write_bytes</span></code>、や<code class="language-crystal highlighter-rouge"><span class="c1">#skip_to_end</span></code> がスキップした/書き込んだバイト数の数値を返すようになったことがあります。これは他の言語でもそのようになっており、書き込み中に追加の呼び出しなく現在のストリームを位置を把握できるようになります。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9233">#9233</a> and <a href="https://github.com/crystal-lang/crystal/pull/9363">#9363</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="nd">@[Experimental]</span></code> アノテーションという、ライブラリや言語、shardの部分に細心の注意と共に使う必要のあるという指定をするためのものが導入されました。実験的な (experimental) 機能は変更や破壊、もしくは削除を Semver の規約に関わらず行なっても良いものとします。今のところ、アノテーションはドキュメントジェネレータで利用されています。ですが、他にも追加の機能のアイディアがあります。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9244">#9244</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="no">Digest</span></code> 型がリファクタリングされて、いくつかのメソッドの名前が変更されたことに注意する必要があるかもしれません。Read more at <a href="https://github.com/crystal-lang/crystal/pull/8426">#8426</a>.</p>

<p>さて、<code class="language-crystal highlighter-rouge"><span class="no">OptionParser</span></code> がサブコマンドを定義できるようになりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9009">#9009</a>.</p>

<p>Some other clean-ups: <code class="language-crystal highlighter-rouge"><span class="no">Flate</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">Gzip</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">Zip</span></code>, and <code class="language-crystal highlighter-rouge"><span class="no">Zlib</span></code> were moved inside <code class="language-crystal highlighter-rouge"><span class="no">Compress</span></code> module in <a href="https://github.com/crystal-lang/crystal/pull/8886">#8886</a>. また、<code class="language-crystal highlighter-rouge"><span class="no">Flate</span></code> は <code class="language-crystal highlighter-rouge"><span class="no">Compress</span><span class="o">::</span><span class="no">Deflate</span></code> に名前が変更されています。<code class="language-crystal highlighter-rouge"><span class="nb">require</span> <span class="s2">"compress/gzip"</span></code> として、これらの定数を変更する必要があります。<code class="language-crystal highlighter-rouge"><span class="nb">require</span> <span class="s2">"gzip"</span></code> は依然として有効ですが、警告メッセージが表示されることになります。</p>

<p>いくつかの変更が <code class="language-crystal highlighter-rouge"><span class="no">File</span></code> と <code class="language-crystal highlighter-rouge"><span class="no">FileUtils</span></code> にあります。これらは整理されて、強制する操作が両方の API で有効になりました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9175">#9175</a>.</p>

<h3 id="マクロ">マクロ</h3>

<p>クロスコンパイルの際、<code class="language-crystal highlighter-rouge"><span class="n">host_flag?</span></code> というマクロが追加されたことを知っておくと便利でしょう。これは <code class="language-crystal highlighter-rouge"><span class="n">flag?</span></code> のようなものですが、ホストのマシンで解決されます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9049">#9049</a>.</p>

<h3 id="数値計算">数値計算</h3>

<p>符号付きと符号無しの数値の混ざった演算のオーバーフローの検出が修正されました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9403">#9403</a>.</p>

<p><code class="language-crystal highlighter-rouge"><span class="no">Int</span><span class="c1">#digits</span></code> というメソッドが追加されて、一貫性のため <code class="language-crystal highlighter-rouge"><span class="no">BigInt</span><span class="c1">#digits</span></code> の出力が反転されました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9383">#9383</a>.</p>

<h3 id="シリアライズ">シリアライズ</h3>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="p">.</span><span class="nf">mapping</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="p">.</span><span class="nf">mapping</span></code> migrated to their own packages: <a href="https://github.com/crystal-lang/json_mapping.cr">github:crystal-lang/json_mapping.cr</a> and <a href="https://github.com/crystal-lang/yaml_mapping.cr">github:crystal-lang/yaml_mapping.cr</a>. これらの機能は十分なものでしたが、現在は <code class="language-crystal highlighter-rouge"><span class="no">JSON</span><span class="o">::</span><span class="no">Serializable</span></code> と <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Serializable</span></code> がより良いものとしてあるため、標準ライブラリから削除されました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9272">#9272</a>.</p>

<h3 id="時刻">時刻</h3>

<p>これからは <code class="language-crystal highlighter-rouge"><span class="no">Time</span><span class="c1">#to_rfc3339</span></code> のデフォルトの精度は秒となり、それ以上の精度は出力されません。より細かな精度が必要な場合は <code class="language-crystal highlighter-rouge"><span class="n">fraction_digits</span></code> という名前付き引数に 0. 3, 6, 9 という精度の桁数を指定してください。In <a href="https://github.com/crystal-lang/crystal/pull/9283">#9283</a> we are dropping the logic to show the fraction of seconds depending on the time value.</p>

<h3 id="ネットワーク">ネットワーク</h3>

<p>We’ve updated the SSL server secure defaults in <a href="https://github.com/crystal-lang/crystal/pull/9026">#9026</a>. And fixed some <code class="language-crystal highlighter-rouge"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span></code> sporadic failures during SSL handshake in <a href="https://github.com/crystal-lang/crystal/pull/9177">#9177</a>.</p>

<p>そして、<code class="language-crystal highlighter-rouge"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span></code>に2つの破壊的な変更があります。We improved the error handling and logging in <a href="https://github.com/crystal-lang/crystal/pull/9115">#9115</a> and integrated it with the new logging module. The <code class="language-crystal highlighter-rouge"><span class="no">HTTP</span><span class="o">::</span><span class="no">Request</span><span class="c1">#remote_address</span></code> type was changed to <code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">Address</span><span class="p">?</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/9210">#9210</a>.</p>

<h3 id="ログ">ログ</h3>

<p>まず初めに、<a href="/2020/04/06/crystal-0.34.0-released.html">0.34.0</a>で導入した新しいログモジールを早期に試してフィードバックを送ってくださった皆様に感謝いたします。破壊的な変更を含むいくつかの変更点がありますが、それらは主要な API には影響しません。これらを組み合わせることで、追加の機能といくつかのユースケースでのパーフォマンスの改善を達成しています。</p>

<p>We renamed <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Severity</span><span class="o">::</span><span class="no">Warning</span></code> to <code class="language-crystal highlighter-rouge"><span class="no">Warn</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/9293">#9293</a>. <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">warn</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span></code> がありましたが、これはそのままで、警告を表します。。この変更は <code class="language-crystal highlighter-rouge"><span class="ss">:warning</span></code> やほとんどの環境変数経由での設定に影響します。Similarly, we dropped <code class="language-crystal highlighter-rouge"><span class="no">Verbose</span></code>, and added <code class="language-crystal highlighter-rouge"><span class="no">Trace</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">Notice</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/9107">#9107</a>.</p>

<p>ログのセットアップがよりシンプルになりました。<code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">setup</span><span class="o">*</span></code> 系の2つのメソッドがあります。これらのメソッドは常にソースとバックエンドの間のバインディングを完全に設定するでしょう。</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">Log</span><span class="p">.</span><span class="nf">setup</span> <span class="ss">:debug</span> <span class="c1"># will show debug or above in the stdout for all source</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">setup</span> <span class="s2">"db.*"</span><span class="p">,</span> <span class="ss">:trace</span> <span class="c1"># will show trace or above in the stdout for db.* sources and nothing else</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span> <span class="c1"># will grab the value of LOG_LEVEL env variable</span>
</code></pre></div></div>

<p><code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span></code> が1つの環境変数を受け取って動作するようになったことにも注意してください。より柔軟なものが今後追加されるかもしれませんが、名前付き引数はより良い体験を提供するはずです。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9145">#9145</a>.</p>

<p>各エントリはこれまでより、現在実行しているファイバーから取得したコンテキストの情報を持っていました。その <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Context</span></code> の責務を <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span></code> と <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span><span class="o">::</span><span class="no">Value</span></code> に分割することにしました。前者は<code class="language-crystal highlighter-rouge"><span class="no">Symbol</span></code> から <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span><span class="o">::</span><span class="no">Value</span></code> へのハッシュのようなデータ構造ですが、アロケーションやアルゴリズム的な最適化がされています。The main work was done in <a href="https://github.com/crystal-lang/crystal/pull/9227">#9227</a> and <a href="https://github.com/crystal-lang/crystal/pull/9295">#9295</a>. これらのリファクタリングによって、クローンによって獲得していた <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="o">::</span><span class="no">Metadata</span><span class="o">::</span><span class="no">Value</span></code> の不変性 (immutability) が無くなりました。</p>

<p>ログエントリにローカルのメタデータや構造化された情報を追加したいという機能が望まれていました。もちろん、現在のファイバのコンテキストに対する変更や復旧が最小であるものが望ましいです。エントリが出力されていない場合は値の生成を省略するという当初の設計を保って、これを達成しました。</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="p">{</span> <span class="s2">"Program started"</span> <span class="p">}</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"Program started"</span><span class="p">)</span> <span class="c1"># same as previous</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"User logged in"</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">42</span><span class="p">)</span> <span class="c1"># local data</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"User logged in"</span><span class="p">,</span> <span class="n">expr_that_computes_hash_named_tuple_or_metadata</span><span class="p">)</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">warn</span> <span class="ss">exception: </span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"Oh no!"</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">42</span><span class="p">)</span> <span class="c1"># with exception</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">warn</span> <span class="ss">exception: </span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="s2">"Oh no!"</span><span class="p">)</span> <span class="c1"># with exception, no local data</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="ss">exception: </span><span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"Oh no!"</span> <span class="p">}</span> <span class="c1"># same as previous</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="o">&amp;</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="ss">action: </span><span class="s2">"log_in"</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">42</span><span class="p">)</span> <span class="c1"># empty message</span>
</code></pre></div></div>

<p>How to create custom log formatters was revisited in <a href="https://github.com/crystal-lang/crystal/pull/9211">#9211</a>. ブロックや Proc からフォーマッタを作る方法はまだ利用できますが、文字列から直接フォーマッタを定義するシンプルな方法を確認してみてください。</p>

<p>出力するログのエントリーをテストしたい場合、新しく追加された <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">capture</span></code> というヘルパーが利用できます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9201">#9201</a>.</p>

<h3 id="並行処理">並行処理</h3>

<p><code class="language-crystal highlighter-rouge"><span class="no">Concurrent</span><span class="o">::</span><span class="no">Future</span></code> とトップレベルの <code class="language-crystal highlighter-rouge"><span class="n">delay</span></code>、<code class="language-crystal highlighter-rouge"><span class="n">future</span></code>、<code class="language-crystal highlighter-rouge"><span class="n">lazy</span></code> を削除しました。If you want to keep using them, use the <a href="https://github.com/crystal-community/future.cr">github:crystal-community/future.cr</a> shard. Read more at <a href="https://github.com/crystal-lang/crystal/pull/9093">#9093</a>.</p>

<p>Another feature that was dropped is the <code class="language-crystal highlighter-rouge"><span class="n">parallel</span></code> macro in <a href="https://github.com/crystal-lang/crystal/pull/9097">#9097</a>.</p>

<p>1.0 以降に向けて、より堅牢で様々な利用に耐えうるもの開発したいと考えています。</p>

<h3 id="ランタイム">ランタイム</h3>

<p><code class="language-crystal highlighter-rouge"><span class="no">Process</span><span class="c1">#signal</span></code> があるので <code class="language-crystal highlighter-rouge"><span class="no">Process</span><span class="c1">#kill</span></code> を非推奨としました。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9006">#9006</a>.</p>

<p>また <code class="language-crystal highlighter-rouge"><span class="nb">fork</span></code> も非推奨となりました。これはマルチスレッド環境では有効ではありません。この変更が問題である場合は、<code class="language-crystal highlighter-rouge"><span class="no">Process</span><span class="p">.</span><span class="nf">fork</span></code> はまだ利用できるのでそちらを使ってください。しかし、このメソッドはもはや公開された API ではありません。Read more at <a href="https://github.com/crystal-lang/crystal/pull/9136">#9136</a>.</p>

<h3 id="プラットフォーム">プラットフォーム</h3>

<p>For macOS users, we fixed some compatibility issues with 10.15 (Catalina) in <a href="https://github.com/crystal-lang/crystal/pull/9296">#9296</a>.</p>

<p>For BSD users, we added support for DragonFly(BSD) in <a href="https://github.com/crystal-lang/crystal/pull/9178">#9178</a>.</p>

<p>For musl users, we fixed some weird segfaults in <a href="https://github.com/crystal-lang/crystal/pull/9238">#9238</a> and fixed some empty backtraces <a href="https://github.com/crystal-lang/crystal/pull/9267">#9267</a>.</p>

<p>Windows ユーザーへはたくさんのお知らせがあります。To see the ongoing efforts don’t miss the <a href="https://github.com/crystal-lang/crystal/wiki/Porting-to-Windows">wiki page</a> and <a href="https://github.com/crystal-lang/crystal/issues/5430">#5430</a>.</p>

<p>今回のリリースでの Windows 向けの変更としては次のようなものがあります。</p>

<ul>
  <li><code class="language-crystal highlighter-rouge"><span class="no">File</span></code> improvements <a href="https://github.com/crystal-lang/crystal/pull/9015">#9015</a>, <a href="https://github.com/crystal-lang/crystal/pull/9038">#9038</a>, <a href="https://github.com/crystal-lang/crystal/pull/9037">#9037</a>, <a href="https://github.com/crystal-lang/crystal/pull/9257">#9257</a>.</li>
  <li><code class="language-crystal highlighter-rouge"><span class="no">IO</span></code> behaviour was aligned in <a href="https://github.com/crystal-lang/crystal/pull/9207">#9207</a>.</li>
  <li><code class="language-crystal highlighter-rouge"><span class="no">Process</span></code> was implemented <a href="https://github.com/crystal-lang/crystal/pull/9047">#9047</a>, <a href="https://github.com/crystal-lang/crystal/pull/9021">#9021</a>, <a href="https://github.com/crystal-lang/crystal/pull/9122">#9122</a>, <a href="https://github.com/crystal-lang/crystal/pull/9112">#9112</a>, <a href="https://github.com/crystal-lang/crystal/pull/9149">#9149</a>, <a href="https://github.com/crystal-lang/crystal/pull/9310">#9310</a></li>
  <li><code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">spec</span></code> command deals with Windows paths in <a href="https://github.com/crystal-lang/crystal/pull/9234">#9234</a></li>
  <li>そして、コンパイラ自身を Windows 上でブートストラップできるようになりました。<a href="https://github.com/crystal-lang/crystal/pull/9054">#9054</a>, <a href="https://github.com/crystal-lang/crystal/pull/9062">#9062</a>, <a href="https://github.com/crystal-lang/crystal/pull/9095">#9095</a>, <a href="https://github.com/crystal-lang/crystal/pull/9106">#9106</a>, <a href="https://github.com/crystal-lang/crystal/pull/9307">#9307</a>.</li>
</ul>

<p>ですが、まだ標準ライブラリのすべての部分が Windows で利用できるというというわけではないことには注意してください。</p>

<h3 id="ツール">ツール</h3>

<p>主要な変更はドキュメントジェネレータで、バージョンピッカーをサポートするようになりました。外部に <code class="language-crystal highlighter-rouge"><span class="p">.</span><span class="nf">json</span></code> ファイルを用意して、現在と過去のリリースを指定することでバージョンピッカーに反映できます。Read more at <a href="https://github.com/crystal-lang/crystal/pull/8792">#8792</a>, <a href="https://github.com/crystal-lang/crystal/pull/9074">#9074</a>, and <a href="https://github.com/crystal-lang/crystal/pull/9254">#9254</a>.</p>

<h2 id="次のステップ">次のステップ</h2>

<p>Crystal をアップデートしてください。そして、問題の報告を心待ちにしています。私たちは1.0.0に向けての開発を始めています。1.0.0-preX のようなリリースをして、最終的な調整を重ねていくでしょう。</p>

<p>ここ数回のリリースで修正が多かったことは認めます。ですが、不快感は最小になるように心掛けたつもりです。</p>

<p>すべての非推奨にした定義は1.0では削除される予定です。1.0をクリーンなバージョンにしたいと思っています。</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, <a href="https://nikolamotor.com/">Nikola Motor Company</a> and every other <a href="/sponsors">sponsor</a>. 継続的に開発・メンテナンスを続けていくには、寄付が不可欠です。<a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Crystal の直接のスポンサーになりたい場合や、他のサポート方法を探している場合は <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> に連絡してください。それでは、ここまで読んでいただきありがとうございます！</p>


      </div>
      <div class="col m1"></div>
    </div>
  </div>
</main>


  <footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born & raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>

</div>


    <script src="/assets/js/bundle.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
