<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Crystal 0.34.0 released! - The Crystal Programming Language</title>
    <meta charset='utf-8'>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'>
    <link href="/assets/stylesheet.css" rel="stylesheet" />
    <link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Crystal 0.34.0 released! | プログラミング言語 Crystal</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Crystal 0.34.0 released!" />
<meta name="author" content="bcardiff" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Crystal 0.34.0 has been released!" />
<meta property="og:description" content="Crystal 0.34.0 has been released!" />
<link rel="canonical" href="https://ja.crystal-lang.org/2020/04/06/crystal-0.34.0-released.html" />
<meta property="og:url" content="https://ja.crystal-lang.org/2020/04/06/crystal-0.34.0-released.html" />
<meta property="og:site_name" content="プログラミング言語 Crystal" />
<meta property="og:image" content="https://ja.crystal-lang.org/assets/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ja.crystal-lang.org/assets/icon.png" />
<meta property="twitter:title" content="Crystal 0.34.0 released!" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@bcardiff" />
<script type="application/ld+json">
{"datePublished":"2020-04-06T00:00:00+00:00","dateModified":"2020-04-06T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ja.crystal-lang.org/2020/04/06/crystal-0.34.0-released.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ja.crystal-lang.org/assets/media/crystal_logo.svg"},"name":"bcardiff"},"url":"https://ja.crystal-lang.org/2020/04/06/crystal-0.34.0-released.html","author":{"@type":"Person","name":"bcardiff"},"@type":"BlogPosting","image":"https://ja.crystal-lang.org/assets/icon.png","headline":"Crystal 0.34.0 released!","description":"Crystal 0.34.0 has been released!","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Let browser know website is optimized for mobile -->
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper ">
  <nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/conference/">
      Conference
    </a>
  </li>
<li>
    <a href="/team/">
      Team
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      
<li>
    <a href="/">
      Home
    </a>
  </li>
<li>
    <a href="https://forum.crystal-lang.org" target="_blank">
      Forum
    </a>
  </li>
<li>
    <a href="/blog/">
      Blog
    </a>
  </li>
<li>
    <a href="/sponsors/">
      Sponsors
    </a>
  </li>
<li>
    <a href="/community/">
      Community
    </a>
  </li>
<li>
    <a href="/conference/">
      Conference
    </a>
  </li>
<li>
    <a href="/team/">
      Team
    </a>
  </li>
<li>
    <a href="/docs/">
      Docs
    </a>
  </li>
<li>
    <a href="https://github.com/crystal-lang/crystal" target="_blank">
      GitHub
    </a>
  </li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>


  <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/bcardiff.jpg" />
          
          
            <span class="author_name">Brian J. Cardiff</span>
          
          <span class="date">06 Apr 2020</span>
        </div>

        <h1 class='title'>Crystal 0.34.0 released!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>


<main>
  <div class="container">
    <div class="row post-layout">
      <div class="col m2 share">
        <p class="title small share-title">Share</p>
        <div class="share-list">
          
          <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fja.crystal-lang.org%2F2020%2F04%2F06%2Fcrystal-0.34.0-released.html&text=Crystal+0.34.0+released%21&via=CrystalLanguage" target="_blank">
            <div class="share-item"><i class="extra-icons twitter gray"></i></div>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fja.crystal-lang.org%2F2020%2F04%2F06%2Fcrystal-0.34.0-released.html" target="_blank">
            <div class="share-item"><i class="extra-icons facebook gray"></i></div>
          </a>
          <a href="https://plus.google.com/share?url=https%3A%2F%2Fja.crystal-lang.org%2F2020%2F04%2F06%2Fcrystal-0.34.0-released.html" target="_blank">
            <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
            </a>
        </div>
      </div>

      <div class="col s12 m9">
        <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.34.0">Crystal 0.34.0</a> has been released!</p>

<p>Get excited because this release comes with some of the final touches to the language before 1.0: a better exception hierarchy to replace Errno, a new logging module, cleanups and fixes aiming for a better, more stable release, one that should make us all proud.</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.33.0...0.34.0">183 commits since 0.33.0</a> by 26 contributors.</p>

<p>Let’s get right into some of the highlights in this release. But don’t miss out on the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.34.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="language-changes">Language changes</h2>

<h3 id="exhaustive-case">Exhaustive Case</h3>

<p>From now on a <code class="language-crystal highlighter-rouge"><span class="k">case</span></code> expression will no longer have an implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code>. This is useful to enable an exhaustive check across the <code class="language-crystal highlighter-rouge"><span class="k">when</span></code> branches within the <code class="language-crystal highlighter-rouge"><span class="k">case</span></code>. If you are doing <code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="n">exp</span></code> over a union or an enum value, and you are missing a <code class="language-crystal highlighter-rouge"><span class="k">when</span></code> to cover some type or value, the compiler will let you know. Unless you have an <code class="language-crystal highlighter-rouge"><span class="k">else</span></code> at the end of the <code class="language-crystal highlighter-rouge"><span class="k">case</span></code>.</p>

<p>Note: In this version, when the <code class="language-crystal highlighter-rouge"><span class="k">case</span></code> does not cover all the possibilities, a warning is generated, and the <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> is implicitly added. In the next version it will produce a compile-time error and the implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> will be gone.</p>

<p>The following snippet complains about the missing <code class="language-crystal highlighter-rouge"><span class="k">when</span> <span class="no">Char</span></code></p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">||</span> <span class="s1">'x'</span> <span class="o">||</span> <span class="s2">"foo"</span>
<span class="k">case</span> <span class="n">a</span>
<span class="k">when</span> <span class="no">Int32</span>
  <span class="c1"># ...</span>
<span class="k">when</span> <span class="no">String</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And the following snippet complains about the missing <code class="language-crystal highlighter-rouge"><span class="k">when</span> <span class="no">West</span></code></p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">enum</span> <span class="no">Direction</span>
  <span class="no">North</span><span class="p">;</span> <span class="no">South</span><span class="p">;</span> <span class="no">East</span><span class="p">;</span> <span class="no">West</span>
<span class="k">end</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Direction</span><span class="o">::</span><span class="no">North</span>
<span class="k">case</span> <span class="n">d</span>
<span class="k">when</span> <span class="p">.</span><span class="nf">north?</span><span class="p">,</span> <span class="p">.</span><span class="nf">south?</span>
  <span class="c1"># ...</span>
<span class="k">when</span> <span class="p">.</span><span class="nf">east?</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The only case that will still have an implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> is when there is no expression and only a list of <code class="language-crystal highlighter-rouge"><span class="k">when</span></code> statements. This construction is equivalent to multiple <code class="language-crystal highlighter-rouge"><span class="k">if</span></code>/<code class="language-crystal highlighter-rouge"><span class="n">elseif</span></code> where there is an implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> also.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">case</span>
<span class="k">when</span> <span class="n">x</span><span class="p">.</span><span class="nf">even?</span>  <span class="c1"># if x.even?</span>
  <span class="c1"># ...</span>
<span class="k">when</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">10</span>  <span class="c1"># elsif y &gt;= 0</span>
  <span class="c1"># ...</span>
<span class="k">end</span>           <span class="c1"># end</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8424">#8424</a>.</p>

<h3 id="procs-subtyping">Procs subtyping</h3>

<p>While dealing with <code class="language-crystal highlighter-rouge"><span class="no">Procs</span></code> and callbacks it is common to not use the return value. In Crystal, that usually means returning <code class="language-crystal highlighter-rouge"><span class="kp">nil</span></code>. In regular methods you can specify the return type <code class="language-crystal highlighter-rouge"><span class="p">:</span> <span class="no">Nil</span></code> to ignore the value of the last expression.</p>

<p>The counterpart in <code class="language-crystal highlighter-rouge"><span class="no">Procs</span></code> is harder because there usually is no type annotation for the return type.</p>

<p>For ease of use, we make it that any <code class="language-crystal highlighter-rouge"><span class="no">Proc</span><span class="p">(</span><span class="no">T</span><span class="p">)</span></code> should be able to be used as a <code class="language-crystal highlighter-rouge"><span class="no">Proc</span><span class="p">(</span><span class="no">Nil</span><span class="p">)</span></code>. That is, ignoring the return value in runtime. So, for those that like formality, <code class="language-crystal highlighter-rouge"><span class="no">Proc</span><span class="p">(</span><span class="no">T</span><span class="p">)</span> <span class="o">&lt;</span> <span class="no">Proc</span><span class="p">(</span><span class="no">Nil</span><span class="p">)</span></code> is a valid subtyping rule now.</p>

<p>There was a previous attempt to achieve something similar, but in this version, a better handling of that affair was implemented. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8970">#8970</a>.</p>

<h2 id="compiler">Compiler</h2>

<p>The <code class="language-crystal highlighter-rouge"><span class="n">disable_overflow</span></code> compiler flag is dropped. This means that the usual arithmetic operators will always have the overflow check. Use <code class="language-crystal highlighter-rouge"><span class="o">&amp;+</span></code> and others to skip overflow checks. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8772">#8772</a>.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_OPTS</span></code> environment variable can now be used to inject compiler options and flags implicitly. This is useful, for example, when the compiler is used in <code class="language-crystal highlighter-rouge"><span class="n">post_install</span></code> steps of shards and you want to enforce <code class="language-crystal highlighter-rouge"><span class="o">--</span><span class="n">error</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">warnings</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8900">#8900</a>.</p>

<p>LLVM 10 has just been released and we added support for it. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8940">#8940</a>.</p>

<p>The codegen for Windows has been improved to work without <code class="language-crystal highlighter-rouge"><span class="o">--</span><span class="n">single</span><span class="o">-</span><span class="n">module</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8978">#8978</a>.</p>

<h2 id="shards">Shards</h2>

<p>A new version of Shards (0.10.0) has been released. Until now you probably have been using Shards 0.8.1 which lacks some features. Shards 0.9.0 polished many use cases, but it uses a SAT solver, which doesn’t scale. For Shards 0.10.0 we created <a href="https://github.com/crystal-lang/crystal-molinillo">crystal-molinillo</a> a port of the dependency resolution algorithm used by <a href="https://bundler.io/">Bundler</a> and <a href="https://cocoapods.org/">CocoaPods</a>.</p>

<p>You can read the rest of the updates in the <a href="https://github.com/crystal-lang/shards/releases/tag/v0.10.0">release changelog</a>.</p>

<p>We will be eagerly waiting for feedback from you on Shards to polish it before 1.0.</p>

<h2 id="standard-library">Standard library</h2>

<h3 id="errno-no-more">Errno no more</h3>

<p>Having as much as possible portable code is part of the goal of the std-lib. One of the areas that were in need of polishing was how <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">WinError</span></code> were handled. The <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">WinError</span></code> exceptions are now gone, and were replaced by a new hierarchy of exceptions. Unfortunately, there is no easy way to make a smooth transition here with deprecation warnings. The <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Timeout</span></code> exception was renamed to <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">TimeoutError</span></code> to match the new hierarchy:</p>

<ul>
  <li><code class="language-crystal highlighter-rouge"><span class="no">Exception</span></code>
    <ul>
      <li><code class="language-crystal highlighter-rouge"><span class="no">RuntimeError</span></code></li>
      <li><code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>
        <ul>
          <li><code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">TimeoutError</span></code> (inherits <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>)</li>
          <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">Error</span></code> (inherits <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>)
            <ul>
              <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">NotFoundError</span></code></li>
              <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">AccessDeniedError</span></code></li>
              <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">AlreadyExistsError</span></code></li>
            </ul>
          </li>
          <li><code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">Error</span></code> (inherits <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>)
            <ul>
              <li><code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">ConnectError</span></code></li>
              <li><code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">BindError</span></code></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>So, you can now use these new types to catch specific errors instead of checking <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> values. We included the most used errors as classes. If there is no specific class, the base <code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">Error</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">Error</span></code> will be raised with a meaningful description.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">WinError</span></code> underlying value is still present if you need it, via the <code class="language-crystal highlighter-rouge"><span class="no">SystemError</span></code> module included in this new hierarchy. But it is better if you avoid using it.</p>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8885">#8885</a>.</p>

<h3 id="log">Log</h3>

<p>The former <code class="language-crystal highlighter-rouge"><span class="no">Logger</span></code> module is deprecated and will be removed soon. Its replacement is the <code class="language-crystal highlighter-rouge"><span class="no">Log</span></code> module: it’s shorter, more flexible and convenient.</p>

<p>You can use the top-level <code class="language-crystal highlighter-rouge"><span class="no">Log</span></code> constant to emit log entries, or you can declare one inside your module or class. This allows the entries to be emitted from a <em>source</em>.</p>

<p>Each source will be configured to send the entries to different <em>backends</em> depending on the severity level. If you initialize the logging with <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span></code> you will be able to filter the level and the sources using the <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_LEVEL</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_SOURCES</span></code> environment variables.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="c1"># file app.cr</span>
<span class="nb">require</span> <span class="s2">"log"</span>

<span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span>

<span class="k">class</span> <span class="nc">MyApp</span>
  <span class="no">Log</span> <span class="o">=</span> <span class="o">::</span><span class="no">Log</span><span class="p">.</span><span class="nf">for</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">run</span>
	<span class="no">Log</span><span class="p">.</span><span class="nf">debug</span> <span class="p">{</span> <span class="s2">"the app is running"</span> <span class="p">}</span> <span class="c1"># log from myapp source</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">MyApp</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">run</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="p">{</span> <span class="s2">"finished"</span> <span class="p">}</span> <span class="c1"># log from the top-level source</span>
</code></pre></div></div>

<p>If you want to log see all the log entries of the app above, you will need to set both environment variables, since their default values are <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_LEVEL</span><span class="o">=</span><span class="no">INFO</span></code> <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_SOURCES</span><span class="o">=</span><span class="s2">""</span></code> (only top-level).</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="err">$</span> <span class="no">CRYSTAL_LOG_LEVEL</span><span class="o">=</span><span class="no">DEBUG</span> <span class="no">CRYSTAL_LOG_SOURCES</span><span class="o">=</span><span class="s2">"*"</span> <span class="p">.</span><span class="nf">/</span><span class="n">app</span>
<span class="no">D</span><span class="p">,</span> <span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="no">T21</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mf">50.079554000</span><span class="no">Z</span> <span class="c1">#26206]   DEBUG -- app:my_app: the app is running</span>
<span class="no">I</span><span class="p">,</span> <span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="no">T21</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mf">50.079624000</span><span class="no">Z</span> <span class="c1">#26206]    INFO -- app:: finished</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8847">#8847</a> and check <a href="https://crystal-lang.org/api/0.34.0/Log.html">the docs</a> for how you can define your own backends and use more advanced features of this module.</p>

<h3 id="top-level-cleanup">Top level cleanup</h3>

<p>As we prepare for 1.0, we wanted to iterate and clean up some of the top-level of the std-lib and prelude. That is the reason behind many deprecations that involved part of <code class="language-crystal highlighter-rouge"><span class="no">Colorize</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/8892">#8892</a>, <code class="language-crystal highlighter-rouge"><span class="no">Iconv</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/8890">#8890</a>, <code class="language-crystal highlighter-rouge"><span class="no">DL</span></code> <a href="https://github.com/crystal-lang/crystal/pull/8882">#8882</a>.</p>

<p>Some modules were moved out of the top-level: <code class="language-crystal highlighter-rouge"><span class="no">Adler32</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">CRC32</span></code> are inside <code class="language-crystal highlighter-rouge"><span class="no">Digest</span></code> <a href="https://github.com/crystal-lang/crystal/pull/8881">#8881</a>, and <code class="language-crystal highlighter-rouge"><span class="no">AtExitHandlers</span></code> inside <code class="language-crystal highlighter-rouge"><span class="no">Crystal</span></code> <a href="https://github.com/crystal-lang/crystal/pull/8883">#8883</a>.</p>

<p>There might be some more cleanups/renames before 1.0 to avoid wanting some trivial early breaking-changes.</p>

<h3 id="collections">Collections</h3>

<p>On the performance corner of this release, when using <code class="language-crystal highlighter-rouge"><span class="no">Array</span><span class="c1">#fill</span></code> for writing all zero values, it will now use <code class="language-crystal highlighter-rouge"><span class="n">memset</span></code> for the entire underlying buffer, instead of iterating every position. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8903">#8903</a>.</p>

<h3 id="serialization">Serialization</h3>

<p>There is a small breaking change in <code class="language-crystal highlighter-rouge"><span class="no">YAML</span></code> in order to align the API of all builders. <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span></code> with block was renamed to <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">build</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/8896">#8896</a>.</p>

<p>When using the different format builders, <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="c1">#flush</span></code> will be called to ensure all the content will get through in case you are not closing properly the destination file. This applies to <code class="language-crystal highlighter-rouge"><span class="no">CSV</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">INI</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">JSON</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">XML</span></code>, and <code class="language-crystal highlighter-rouge"><span class="no">YAML</span></code> builders. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8876">#8876</a>.</p>

<h3 id="time">Time</h3>

<p>It’s time for more breaking-changes in favor of less error-prone code. The <code class="language-crystal highlighter-rouge"><span class="no">Time</span><span class="o">::</span><span class="no">Span</span></code> initialization API will use mandatory named arguments, like <code class="language-crystal highlighter-rouge"><span class="no">Time</span><span class="o">::</span><span class="no">Span</span><span class="p">.</span><span class="nf">new</span> <span class="ss">minutes: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">3</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8257">#8257</a>.</p>

<h3 id="files">Files</h3>

<p>When closing a <code class="language-crystal highlighter-rouge"><span class="no">File</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">Socket</span></code> the internal <code class="language-crystal highlighter-rouge"><span class="n">fd</span></code> is set to <code class="language-crystal highlighter-rouge"><span class="o">-</span><span class="mi">1</span></code> to force an invalid file descriptor and avoid mixing <code class="language-crystal highlighter-rouge"><span class="n">fd</span></code> from different <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code>s. In single-thread, this was never an issue, but on multi-thread, as usual, issues like this one can cause big headaches. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8873">#8873</a>.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Buffered</span><span class="c1">#flush_on_newline</span></code> is back. And its default value will be helpful for building CLI tools and pipe them into other commands. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8935">#8935</a>.</p>

<h3 id="http">HTTP</h3>

<p>The WebSocket support was lacking the proper handling of close code. In order to implement them, a breaking-change on the server-side and in client-side parts was needed. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8975">#8975</a> and <a href="https://github.com/crystal-lang/crystal/pull/8981">#8981</a>.</p>

<h3 id="windows">Windows</h3>

<p>The windows support is moving forward while enabling more specs, and more contributors are jumping into the adventure. Check out <a href="https://github.com/crystal-lang/crystal/pull/8683">#8683</a> and <a href="https://github.com/crystal-lang/crystal/pull/8822">#8822</a>, <a href="https://github.com/crystal-lang/crystal/pull/8885">#8885</a>, <a href="https://github.com/crystal-lang/crystal/pull/8958">#8958</a>.</p>

<h2 id="tools">Tools</h2>

<p>The <code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">init</span></code> tool got some polishing. The name of the shard is validated with respect <a href="https://github.com/crystal-lang/shards/blob/master/SPEC.md#name">shards spec</a> and it can be inferred from the directory. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8737">#8737</a>.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">docs</span></code> tool will now show warnings. In previous releases we switched to <code class="language-crystal highlighter-rouge"><span class="ss">:ditto</span><span class="p">:</span></code> and <code class="language-crystal highlighter-rouge"><span class="ss">:nodoc</span><span class="p">:</span></code> as magic comments. But we missed showing you the warnings in case you forget to add the colons. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8880">#8880</a>.</p>

<h2 id="next-steps">Next steps</h2>

<p>Please update your Crystal and report any issues. We will keep moving forward and start the development focusing on 0.35. There won’t be many more 0.x releases. We are getting super close to 1.0!.</p>

<p>Again, we will be eagerly waiting for feedback from you on Shards to polish it before 1.0.</p>

<p>All deprecation warnings will soon be gone, and there will be errors in the next release. We want a clean 1.0.</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, <a href="https://nikolamotor.com/">Nikola Motor Company</a> and every other <a href="/sponsors">sponsor</a>. It is extremely important for us to sustain the support through donations, so that we can maintain this development pace. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!</p>

      </div>
      <div class="col m1"></div>
    </div>

    <div class="row disqus">
      <div class="col m2"></div>
      <div class="col s12 m9" id='disqus_thread'>
        <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.34.0">Crystal 0.34.0</a> has been released!</p>

<p>Get excited because this release comes with some of the final touches to the language before 1.0: a better exception hierarchy to replace Errno, a new logging module, cleanups and fixes aiming for a better, more stable release, one that should make us all proud.</p>

<p>There are <a href="https://github.com/crystal-lang/crystal/compare/0.33.0...0.34.0">183 commits since 0.33.0</a> by 26 contributors.</p>

<p>Let’s get right into some of the highlights in this release. But don’t miss out on the rest of the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.34.0">release changelog</a> which has a lot of valuable information.</p>

<h2 id="language-changes">Language changes</h2>

<h3 id="exhaustive-case">Exhaustive Case</h3>

<p>From now on a <code class="language-crystal highlighter-rouge"><span class="k">case</span></code> expression will no longer have an implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code>. This is useful to enable an exhaustive check across the <code class="language-crystal highlighter-rouge"><span class="k">when</span></code> branches within the <code class="language-crystal highlighter-rouge"><span class="k">case</span></code>. If you are doing <code class="language-crystal highlighter-rouge"><span class="k">case</span> <span class="n">exp</span></code> over a union or an enum value, and you are missing a <code class="language-crystal highlighter-rouge"><span class="k">when</span></code> to cover some type or value, the compiler will let you know. Unless you have an <code class="language-crystal highlighter-rouge"><span class="k">else</span></code> at the end of the <code class="language-crystal highlighter-rouge"><span class="k">case</span></code>.</p>

<p>Note: In this version, when the <code class="language-crystal highlighter-rouge"><span class="k">case</span></code> does not cover all the possibilities, a warning is generated, and the <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> is implicitly added. In the next version it will produce a compile-time error and the implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> will be gone.</p>

<p>The following snippet complains about the missing <code class="language-crystal highlighter-rouge"><span class="k">when</span> <span class="no">Char</span></code></p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">||</span> <span class="s1">'x'</span> <span class="o">||</span> <span class="s2">"foo"</span>
<span class="k">case</span> <span class="n">a</span>
<span class="k">when</span> <span class="no">Int32</span>
  <span class="c1"># ...</span>
<span class="k">when</span> <span class="no">String</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And the following snippet complains about the missing <code class="language-crystal highlighter-rouge"><span class="k">when</span> <span class="no">West</span></code></p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">enum</span> <span class="no">Direction</span>
  <span class="no">North</span><span class="p">;</span> <span class="no">South</span><span class="p">;</span> <span class="no">East</span><span class="p">;</span> <span class="no">West</span>
<span class="k">end</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Direction</span><span class="o">::</span><span class="no">North</span>
<span class="k">case</span> <span class="n">d</span>
<span class="k">when</span> <span class="p">.</span><span class="nf">north?</span><span class="p">,</span> <span class="p">.</span><span class="nf">south?</span>
  <span class="c1"># ...</span>
<span class="k">when</span> <span class="p">.</span><span class="nf">east?</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The only case that will still have an implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> is when there is no expression and only a list of <code class="language-crystal highlighter-rouge"><span class="k">when</span></code> statements. This construction is equivalent to multiple <code class="language-crystal highlighter-rouge"><span class="k">if</span></code>/<code class="language-crystal highlighter-rouge"><span class="n">elseif</span></code> where there is an implicit <code class="language-crystal highlighter-rouge"><span class="k">else</span> <span class="kp">nil</span></code> also.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">case</span>
<span class="k">when</span> <span class="n">x</span><span class="p">.</span><span class="nf">even?</span>  <span class="c1"># if x.even?</span>
  <span class="c1"># ...</span>
<span class="k">when</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">10</span>  <span class="c1"># elsif y &gt;= 0</span>
  <span class="c1"># ...</span>
<span class="k">end</span>           <span class="c1"># end</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8424">#8424</a>.</p>

<h3 id="procs-subtyping">Procs subtyping</h3>

<p>While dealing with <code class="language-crystal highlighter-rouge"><span class="no">Procs</span></code> and callbacks it is common to not use the return value. In Crystal, that usually means returning <code class="language-crystal highlighter-rouge"><span class="kp">nil</span></code>. In regular methods you can specify the return type <code class="language-crystal highlighter-rouge"><span class="p">:</span> <span class="no">Nil</span></code> to ignore the value of the last expression.</p>

<p>The counterpart in <code class="language-crystal highlighter-rouge"><span class="no">Procs</span></code> is harder because there usually is no type annotation for the return type.</p>

<p>For ease of use, we make it that any <code class="language-crystal highlighter-rouge"><span class="no">Proc</span><span class="p">(</span><span class="no">T</span><span class="p">)</span></code> should be able to be used as a <code class="language-crystal highlighter-rouge"><span class="no">Proc</span><span class="p">(</span><span class="no">Nil</span><span class="p">)</span></code>. That is, ignoring the return value in runtime. So, for those that like formality, <code class="language-crystal highlighter-rouge"><span class="no">Proc</span><span class="p">(</span><span class="no">T</span><span class="p">)</span> <span class="o">&lt;</span> <span class="no">Proc</span><span class="p">(</span><span class="no">Nil</span><span class="p">)</span></code> is a valid subtyping rule now.</p>

<p>There was a previous attempt to achieve something similar, but in this version, a better handling of that affair was implemented. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8970">#8970</a>.</p>

<h2 id="compiler">Compiler</h2>

<p>The <code class="language-crystal highlighter-rouge"><span class="n">disable_overflow</span></code> compiler flag is dropped. This means that the usual arithmetic operators will always have the overflow check. Use <code class="language-crystal highlighter-rouge"><span class="o">&amp;+</span></code> and others to skip overflow checks. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8772">#8772</a>.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_OPTS</span></code> environment variable can now be used to inject compiler options and flags implicitly. This is useful, for example, when the compiler is used in <code class="language-crystal highlighter-rouge"><span class="n">post_install</span></code> steps of shards and you want to enforce <code class="language-crystal highlighter-rouge"><span class="o">--</span><span class="n">error</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">warnings</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8900">#8900</a>.</p>

<p>LLVM 10 has just been released and we added support for it. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8940">#8940</a>.</p>

<p>The codegen for Windows has been improved to work without <code class="language-crystal highlighter-rouge"><span class="o">--</span><span class="n">single</span><span class="o">-</span><span class="n">module</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8978">#8978</a>.</p>

<h2 id="shards">Shards</h2>

<p>A new version of Shards (0.10.0) has been released. Until now you probably have been using Shards 0.8.1 which lacks some features. Shards 0.9.0 polished many use cases, but it uses a SAT solver, which doesn’t scale. For Shards 0.10.0 we created <a href="https://github.com/crystal-lang/crystal-molinillo">crystal-molinillo</a> a port of the dependency resolution algorithm used by <a href="https://bundler.io/">Bundler</a> and <a href="https://cocoapods.org/">CocoaPods</a>.</p>

<p>You can read the rest of the updates in the <a href="https://github.com/crystal-lang/shards/releases/tag/v0.10.0">release changelog</a>.</p>

<p>We will be eagerly waiting for feedback from you on Shards to polish it before 1.0.</p>

<h2 id="standard-library">Standard library</h2>

<h3 id="errno-no-more">Errno no more</h3>

<p>Having as much as possible portable code is part of the goal of the std-lib. One of the areas that were in need of polishing was how <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">WinError</span></code> were handled. The <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">WinError</span></code> exceptions are now gone, and were replaced by a new hierarchy of exceptions. Unfortunately, there is no easy way to make a smooth transition here with deprecation warnings. The <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Timeout</span></code> exception was renamed to <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">TimeoutError</span></code> to match the new hierarchy:</p>

<ul>
  <li><code class="language-crystal highlighter-rouge"><span class="no">Exception</span></code>
    <ul>
      <li><code class="language-crystal highlighter-rouge"><span class="no">RuntimeError</span></code></li>
      <li><code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>
        <ul>
          <li><code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">TimeoutError</span></code> (inherits <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>)</li>
          <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">Error</span></code> (inherits <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>)
            <ul>
              <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">NotFoundError</span></code></li>
              <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">AccessDeniedError</span></code></li>
              <li><code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">AlreadyExistsError</span></code></li>
            </ul>
          </li>
          <li><code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">Error</span></code> (inherits <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Error</span></code>)
            <ul>
              <li><code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">ConnectError</span></code></li>
              <li><code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">BindError</span></code></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>So, you can now use these new types to catch specific errors instead of checking <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> values. We included the most used errors as classes. If there is no specific class, the base <code class="language-crystal highlighter-rouge"><span class="no">File</span><span class="o">::</span><span class="no">Error</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">Socket</span><span class="o">::</span><span class="no">Error</span></code> will be raised with a meaningful description.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">Errno</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">WinError</span></code> underlying value is still present if you need it, via the <code class="language-crystal highlighter-rouge"><span class="no">SystemError</span></code> module included in this new hierarchy. But it is better if you avoid using it.</p>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8885">#8885</a>.</p>

<h3 id="log">Log</h3>

<p>The former <code class="language-crystal highlighter-rouge"><span class="no">Logger</span></code> module is deprecated and will be removed soon. Its replacement is the <code class="language-crystal highlighter-rouge"><span class="no">Log</span></code> module: it’s shorter, more flexible and convenient.</p>

<p>You can use the top-level <code class="language-crystal highlighter-rouge"><span class="no">Log</span></code> constant to emit log entries, or you can declare one inside your module or class. This allows the entries to be emitted from a <em>source</em>.</p>

<p>Each source will be configured to send the entries to different <em>backends</em> depending on the severity level. If you initialize the logging with <code class="language-crystal highlighter-rouge"><span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span></code> you will be able to filter the level and the sources using the <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_LEVEL</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_SOURCES</span></code> environment variables.</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="c1"># file app.cr</span>
<span class="nb">require</span> <span class="s2">"log"</span>

<span class="no">Log</span><span class="p">.</span><span class="nf">setup_from_env</span>

<span class="k">class</span> <span class="nc">MyApp</span>
  <span class="no">Log</span> <span class="o">=</span> <span class="o">::</span><span class="no">Log</span><span class="p">.</span><span class="nf">for</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">run</span>
	<span class="no">Log</span><span class="p">.</span><span class="nf">debug</span> <span class="p">{</span> <span class="s2">"the app is running"</span> <span class="p">}</span> <span class="c1"># log from myapp source</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">MyApp</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">run</span>
<span class="no">Log</span><span class="p">.</span><span class="nf">info</span> <span class="p">{</span> <span class="s2">"finished"</span> <span class="p">}</span> <span class="c1"># log from the top-level source</span>
</code></pre></div></div>

<p>If you want to log see all the log entries of the app above, you will need to set both environment variables, since their default values are <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_LEVEL</span><span class="o">=</span><span class="no">INFO</span></code> <code class="language-crystal highlighter-rouge"><span class="no">CRYSTAL_LOG_SOURCES</span><span class="o">=</span><span class="s2">""</span></code> (only top-level).</p>

<div class="language-crystal highlighter-rouge"><div class="highlight"><pre class="code_section"><code><span class="err">$</span> <span class="no">CRYSTAL_LOG_LEVEL</span><span class="o">=</span><span class="no">DEBUG</span> <span class="no">CRYSTAL_LOG_SOURCES</span><span class="o">=</span><span class="s2">"*"</span> <span class="p">.</span><span class="nf">/</span><span class="n">app</span>
<span class="no">D</span><span class="p">,</span> <span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="no">T21</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mf">50.079554000</span><span class="no">Z</span> <span class="c1">#26206]   DEBUG -- app:my_app: the app is running</span>
<span class="no">I</span><span class="p">,</span> <span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="no">T21</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mf">50.079624000</span><span class="no">Z</span> <span class="c1">#26206]    INFO -- app:: finished</span>
</code></pre></div></div>

<p>Read more at <a href="https://github.com/crystal-lang/crystal/pull/8847">#8847</a> and check <a href="https://crystal-lang.org/api/0.34.0/Log.html">the docs</a> for how you can define your own backends and use more advanced features of this module.</p>

<h3 id="top-level-cleanup">Top level cleanup</h3>

<p>As we prepare for 1.0, we wanted to iterate and clean up some of the top-level of the std-lib and prelude. That is the reason behind many deprecations that involved part of <code class="language-crystal highlighter-rouge"><span class="no">Colorize</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/8892">#8892</a>, <code class="language-crystal highlighter-rouge"><span class="no">Iconv</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/8890">#8890</a>, <code class="language-crystal highlighter-rouge"><span class="no">DL</span></code> <a href="https://github.com/crystal-lang/crystal/pull/8882">#8882</a>.</p>

<p>Some modules were moved out of the top-level: <code class="language-crystal highlighter-rouge"><span class="no">Adler32</span></code> and <code class="language-crystal highlighter-rouge"><span class="no">CRC32</span></code> are inside <code class="language-crystal highlighter-rouge"><span class="no">Digest</span></code> <a href="https://github.com/crystal-lang/crystal/pull/8881">#8881</a>, and <code class="language-crystal highlighter-rouge"><span class="no">AtExitHandlers</span></code> inside <code class="language-crystal highlighter-rouge"><span class="no">Crystal</span></code> <a href="https://github.com/crystal-lang/crystal/pull/8883">#8883</a>.</p>

<p>There might be some more cleanups/renames before 1.0 to avoid wanting some trivial early breaking-changes.</p>

<h3 id="collections">Collections</h3>

<p>On the performance corner of this release, when using <code class="language-crystal highlighter-rouge"><span class="no">Array</span><span class="c1">#fill</span></code> for writing all zero values, it will now use <code class="language-crystal highlighter-rouge"><span class="n">memset</span></code> for the entire underlying buffer, instead of iterating every position. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8903">#8903</a>.</p>

<h3 id="serialization">Serialization</h3>

<p>There is a small breaking change in <code class="language-crystal highlighter-rouge"><span class="no">YAML</span></code> in order to align the API of all builders. <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span></code> with block was renamed to <code class="language-crystal highlighter-rouge"><span class="no">YAML</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">build</span></code> in <a href="https://github.com/crystal-lang/crystal/pull/8896">#8896</a>.</p>

<p>When using the different format builders, <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="c1">#flush</span></code> will be called to ensure all the content will get through in case you are not closing properly the destination file. This applies to <code class="language-crystal highlighter-rouge"><span class="no">CSV</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">INI</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">JSON</span></code>, <code class="language-crystal highlighter-rouge"><span class="no">XML</span></code>, and <code class="language-crystal highlighter-rouge"><span class="no">YAML</span></code> builders. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8876">#8876</a>.</p>

<h3 id="time">Time</h3>

<p>It’s time for more breaking-changes in favor of less error-prone code. The <code class="language-crystal highlighter-rouge"><span class="no">Time</span><span class="o">::</span><span class="no">Span</span></code> initialization API will use mandatory named arguments, like <code class="language-crystal highlighter-rouge"><span class="no">Time</span><span class="o">::</span><span class="no">Span</span><span class="p">.</span><span class="nf">new</span> <span class="ss">minutes: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">3</span></code>. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8257">#8257</a>.</p>

<h3 id="files">Files</h3>

<p>When closing a <code class="language-crystal highlighter-rouge"><span class="no">File</span></code> or <code class="language-crystal highlighter-rouge"><span class="no">Socket</span></code> the internal <code class="language-crystal highlighter-rouge"><span class="n">fd</span></code> is set to <code class="language-crystal highlighter-rouge"><span class="o">-</span><span class="mi">1</span></code> to force an invalid file descriptor and avoid mixing <code class="language-crystal highlighter-rouge"><span class="n">fd</span></code> from different <code class="language-crystal highlighter-rouge"><span class="no">IO</span></code>s. In single-thread, this was never an issue, but on multi-thread, as usual, issues like this one can cause big headaches. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8873">#8873</a>.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="no">IO</span><span class="o">::</span><span class="no">Buffered</span><span class="c1">#flush_on_newline</span></code> is back. And its default value will be helpful for building CLI tools and pipe them into other commands. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8935">#8935</a>.</p>

<h3 id="http">HTTP</h3>

<p>The WebSocket support was lacking the proper handling of close code. In order to implement them, a breaking-change on the server-side and in client-side parts was needed. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8975">#8975</a> and <a href="https://github.com/crystal-lang/crystal/pull/8981">#8981</a>.</p>

<h3 id="windows">Windows</h3>

<p>The windows support is moving forward while enabling more specs, and more contributors are jumping into the adventure. Check out <a href="https://github.com/crystal-lang/crystal/pull/8683">#8683</a> and <a href="https://github.com/crystal-lang/crystal/pull/8822">#8822</a>, <a href="https://github.com/crystal-lang/crystal/pull/8885">#8885</a>, <a href="https://github.com/crystal-lang/crystal/pull/8958">#8958</a>.</p>

<h2 id="tools">Tools</h2>

<p>The <code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">init</span></code> tool got some polishing. The name of the shard is validated with respect <a href="https://github.com/crystal-lang/shards/blob/master/SPEC.md#name">shards spec</a> and it can be inferred from the directory. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8737">#8737</a>.</p>

<p>The <code class="language-crystal highlighter-rouge"><span class="n">crystal</span> <span class="n">docs</span></code> tool will now show warnings. In previous releases we switched to <code class="language-crystal highlighter-rouge"><span class="ss">:ditto</span><span class="p">:</span></code> and <code class="language-crystal highlighter-rouge"><span class="ss">:nodoc</span><span class="p">:</span></code> as magic comments. But we missed showing you the warnings in case you forget to add the colons. Read more at <a href="https://github.com/crystal-lang/crystal/pull/8880">#8880</a>.</p>

<h2 id="next-steps">Next steps</h2>

<p>Please update your Crystal and report any issues. We will keep moving forward and start the development focusing on 0.35. There won’t be many more 0.x releases. We are getting super close to 1.0!.</p>

<p>Again, we will be eagerly waiting for feedback from you on Shards to polish it before 1.0.</p>

<p>All deprecation warnings will soon be gone, and there will be errors in the next release. We want a clean 1.0.</p>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, <a href="https://nikolamotor.com/">Nikola Motor Company</a> and every other <a href="/sponsors">sponsor</a>. It is extremely important for us to sustain the support through donations, so that we can maintain this development pace. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> and <a href="https://salt.bountysource.com/teams/crystal-lang">Bountysource</a> are two available channels for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!</p>

      </div>
      <div class="col m1"></div>
    </div>
  </div>
</main>


  <footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born & raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>

</div>


    <script src="/assets/js/bundle.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
